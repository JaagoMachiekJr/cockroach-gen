# LogicTest: 5node-distsql 5node-distsql-disk

statement ok
CREATE TABLE xyz (
  x INT,
  y INT,
  z TEXT
)

statement ok
INSERT INTO xyz VALUES
  (1, 1, NULL),
  (2, 1, 'a'),
  (3, 1, 'b'),
  (4, 2, 'b'),
  (5, 2, 'c')

statement ok
ALTER TABLE xyz SPLIT AT VALUES (2), (3), (4), (5)

statement ok
ALTER TABLE xyz TESTING_RELOCATE VALUES
  (ARRAY[1], 1),
  (ARRAY[2], 2),
  (ARRAY[3], 3),
  (ARRAY[4], 4),
  (ARRAY[5], 5)

query TTITI colnames
SELECT * FROM [SHOW TESTING_RANGES FROM TABLE xyz]
----
Start Key  End Key  Range ID  Replicas  Lease Holder
NULL       /2       1         {1}       1
/2         /3       2         {2}       2
/3         /4       3         {3}       3
/4         /5       4         {4}       4
/5         NULL     5         {5}       5

subtest Union

# Simple UNION ALL and UNION. (The ORDER BY applies to the UNION, not the last select.)
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz UNION ALL SELECT x FROM xyz ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElU-PokAQxe_7KTZ13d7EavAfJ69edOPObcKBoSuGRGnS3SQ6xu8-AQ6ORquHEODIn997r7teUhfItaJNciQL0TsgCJAgIAABIQiYQiygMDola7WpfmmAtTpBNBGQ5UXpqtexgFQbgugCLnMHggjeko8D7ShRZECAIpdkh9qkMNkxMefV6fwJArali36vEOKrAF26m551yZ4gwqsY3FO28fyvjXu0W-Gfl-LBOOI3TW0UGVLPRJ8k2Oi_urj795V3eOeNI7RjGE_ZxrPbAHsVlyNMaBhP2caz10vsJh6MMKFhPGUbz14vsZt4OMKEhvGUbTx7vcReF-yObKFzSz_acJNqQZLaU7NQrS5NSv-MTmub5nFbc_ULRdY1X2XzsM6bT1XA7zCycMDDkoXDOxgf4aALHPJnRj73lKXnPDxj4QUPz7scetEFXrIwem4M-ZKhr2V8zTzRsVPPkC8aTj3R-arhzIPzXfNl58vmo_m24dITne-bnHhwvnGe7JIv3CMdX399BQAA__9E1reF

query I
SELECT x FROM xyz UNION ALL SELECT x FROM xyz ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz UNION SELECT x FROM xyz ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElrFunEAQhvs8RTRttvDsgh1TUaRxE0dOuoiCsCML6cyi3UWyY_HuEVA4nI7ZQ6ClBO6fj__mk5Z3aIym7-ULOch-A4IACQIUCEhAQAqFgNaaipwzdvjJFHjQr5DdCKibtvPD7UJAZSxB9g6-9ieCDH6Vf070RKUmCwI0-bI-jZDW1i-lfctf3_6CgMfOZ59zhKIXYDr_Mc_58pkgw15cz_xWO183lZ8Dc7yCI9dwduqmInVLFjkf47vGWE2W9Gx-0a95kyV-uqbnT2P9-d-a45fF4bez4XiAlAHmblLG6aYidZtLKQ_YW4C5297idFORus33pg7YW4C5297idFORus33lhywtwBzt73F6aYidVs-vC9wnsi1pnF0dohfnnwzHO6kn2n6EnCmsxX9sKYaMdPl45gbb2hyfnqK08VDMz0aXvD_MLLhZBbG87Bkw4onqy3khA2nPDllw1Ly6Vs2fceH77aU_sqG73ny_RYyBhwLSbbJMuQ1w4BnuEk05E3DgGrIuxaC865hQDbcZBvyumHAN9wknOSFkwHh5Drhiv7TvwAAAP__yzkLEg==

query I
SELECT x FROM xyz UNION SELECT x FROM xyz ORDER BY x
----
1
2
3
4
5

# UNION with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x < 3 UNION SELECT x FROM xyz WHERE x >= 3 ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMljFv2zAQhff-CuPWcvBRctIQKOChKOAlKdJsrQZVPAQCHNEgKSBp4P9eyBpSGdHRKsVCo0i_e_f8voGv0BhNt-UTOVA_AEGABAEZCMhBwAYKAQdrKnLO2O4nvWCnn0GtBdTNofXdcSGgMpZAvYKv_Z5AwUP5a0_3VGqyIECTL-v9yeRg66fSvmyfX36DgK_13pNVqy2ufrbrdVatMqXU7vYBBNy1vruA4ijAtP7Ny_nykUDhUVy-z5fa-bqp_HCZLV7gI6f4_GNu-jwhePafguejPm_j28ZYTZb0YH5xnLLJmP9mSs7vxvrz_3yLH0eHXw2G48JoDuwzG81pckfQnC74kGa5sMID-8xWeJrcEYWnCz4sPFtY4YF9Zis8Te6IwtMFHxaeL6zwwD6zFZ4md0Th6YKPP1De8bkndzCNo7OHyvuT190DhvQj9a8dZ1pb0TdrqpNN_3l30p0ONDnf32L_sWv6q27Bv8XIivOBGM_FkhVnvHMW45yz4g3vvGHFUvLqK1Z9zYuvY0J_YsU3vPNNjDMGGAtBFkUZ8phhgDOMAg150jCAGvKshcx51jAAG0bRhjxuGOANo4CTPHAyAJycBlxx_PAnAAD__5eZVtU=

query I
SELECT x FROM xyz WHERE x < 3 UNION SELECT x FROM xyz WHERE x >= 3 ORDER BY x
----
1
2
3
4
5

# UNION with partial overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM xyz WHERE x <= 4 UNION SELECT x FROM xyz WHERE x > 1 ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlj9v2zAQxfd-CuPWcvBRctIQKOChKOAlKdJsrQZVPAQCHNEgKSBp4O9eyBpSGdHR-sNAo0i_e_f8fgNfoTKabvMncqB-AYIACQISEJCCgA1kAg7WFOScsc1PWsFOP4NaCyirQ-2b40xAYSyBegVf-j2Bgof8z57uKddkQYAmn5f7k8nBlk-5fdk-v_wFAd_LvSerVltc_a7X66T4ukqVUrvbBxBwV_vmBrKjAFP7NzPn80cChUdx-ULfSufLqvDdbbZ4gY8c4jMyOK3w4tzJB-VOe33exteVsZos6c787Dhkkz7_zZCcP43153_5Fj_3Dr_qDMel0RxYaDaa4wQfT3O83F2a5dIKDyw0W-Fxgo8vPF7ubuHJ0goPLDRb4XGCjy88Xu5u4enSCg8sNFvhcYKPLzxe7v4Hyjs-9-QOpnJ09lB5f_K6ecCQfqT2teNMbQv6YU1xsmk_706604Em59tbbD92VXvVLPi_GFlx2hHjuViy4oR3TqY4p6x4wztvWLGUvPqKVV_z4uspob-w4hve-WaKMwYYC0E2iTLkMcMAZzgJNORJwwBqyLMWMudZwwBsOIk25HHDAG84CTjJAycDwMlhwGXHT_8CAAD__wb8VtA=

query I
SELECT x FROM xyz WHERE x <= 4 UNION SELECT x FROM xyz WHERE x > 1 ORDER BY x
----
1
2
3
4
5

# UNION ALL with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz UNION ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElL1qwzAUhfc-RTnzLURy0h9PXrMkJXQrHlTrEgyJZSQZkga_e4k8pAlJqSsXj_r5_PlcxDmgMpoXassO6TsECBKEBIQpCDPkhNqagp0z9nilA-Z6h3RCKKu68cftnFAYy0gP8KXfMFK8qY8Nr1hptiBo9qrcBElty62y-2y3_wRh2fj0PhOUSeQtwTT-9Enn1ZqRipb-SSspEze18qb2ZGsqYzVb1meuvL3yYwvzYOqLa9fFyZlYjDPmIbU9xizHSTuktkfaZJy0Q2p7pJ2Ok3ZI7R8L44p2xa42leNfNcLkWCis19y1jzONLfjVmiJouuUycGFDs_PdqewW8yochbl8h0UMLH-EhTijJ5d0EqOexsCzGPgxBn6KgZ9j4JeoV9LvjeXt3VcAAAD__41Qv_4=

query II rowsort
SELECT x, y FROM xyz UNION ALL SELECT y, x from xyz
----
1 1
1 1
1 2
1 3
2 1
2 4
2 5
3 1
4 2
5 2

# UNION ALL and UNION with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzMlkFvm0AQhe_9FdVcs5U8C9guJ19zSaq0t4oD9Y4iS44X7a6lpBH_vQIqpaRhZq0spUcDj2_evseun-FkDd3UD-Sh_A4ICjQoyEBBDgoKqBQ0zu7Je-u6RwbBtXmEcqXgcGrOobtcKdhbR1A-QziEI0EJ3-ofR7qj2pADBYZCfTj2kMYdHmr3tHt8-gkKbs-h_LhDtdNQtQrsOby80of6nqDEVsVjv1oXXhN3-iqOpCdJLwDrDDkyfxOq9o1xbuwn24yf_T3H5BDZJXYvXeVsEpv_s1Uu_odVXr_bLl5NvnyzzMul5cPo5Ztib0dsXGYHELAJd4DEBmM_vjkNjj8-vUyCAjZhgokNxiY4p8FxgtkyCQrYhAkmNhib4JwGxwnmyyQoYBMmmNhgbIJzGpz-C_MG6Y58Y0-eok7YVXdAk7mn4UD39uz29MXZfY8Zft72uv6CIR-Guzj8uD4Nt7oB_xQjK9YjMb4Wa1a85skZK855cc6KC37sghVvePKaFW958uY94i0fVcHP_ZlvyUqoCV8yoSfItwy1AOd7JqSNfNFQaBryVZOc811D4RtBvm2Sc75uuBXgQuEEOF84LRRO84UTnGthWxMKp_nCSbsiXzgtFE5ftrdV7YdfAQAA__-6tMF9

query I
(SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElrFu2zAQhvc-RXFrOPiOku1o8tAlS1Ok3QoNqkQEAhzRICkgaeB3L2wNrgTrToZpebSdn9_lx8cDP6GxlflevBkP2W9AUECgQIOCBBSkkCvYOVsa7607_EkXeKreIVsoqJtdGw5f5wpK6wxknxDqsDWQwa_iz9a8mKIyDhRUJhT19gjZufqtcB-b94-_oOC5DdnXDaoNQb5XYNtwOtKH4tVAhns1HfvTujAkbuhhGokuIX2rfaibMgxYeEKNcvQlnEuL1KPYZLYi05mKXI5yTse3jXWVcabqnZ_vL5lkjL-6ulF8GD183Tsc73PdBGzE6yaQol23yEVOvW63LDKdqcj-daP7GClgIxopkKIZGbnIqUbessh0piL7Rur7GClgIxopkKIZGbnIqUbessh0piL7Rib3MVLARjRSIEUzMnKRU428ZZHpTEWOP5LPcF6M39nGm8Fj-fzJi8Mj2lSvpntxe9u60vxwtjxiuo_Px9zxi8r40P2K3YenpvvpMOD_YWTDxIeJDS97YRyGNRtOeHLChlM-nF4z9pINr3jyig1roe41m37kw4-8JQtBE14yoTPkLUPh_0beM9RCnDdNmp1XDQXXkJcNl0Kc102anfcN1wKcFw4F45BXTpideONI2GskLDZps1212og3joTlRrxyJChHV-034o0jYcMRrxwJyhGvnDQ7b5wWlpzmldOCcppXbjh7vv_yLwAA__-RLS5q

query I
(SELECT x FROM xyz ORDER BY y) UNION (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
2
3
4
5

# UNION ALL with conflicting numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzElkGPmzAQhe_9FdVc40oZA0nKietedqttbxUHGo9WkbIxsh1pt6v89ypQaZttmHHAEscAj89v3sPOGxysofvmmTyUPwFBgQYFGSjIQUEBtYLW2S15b935kV5wZ16gXCrYHdpjOF-uFWytIyjfIOzCnqCEH82vPT1SY8iBAkOh2e07SOt2z417rV5ef4OCh2MoP1eoKg31SYE9hvdX-tA8EZR4UvHY79aFj8RKL-JIepD0DrDOkCPzP6E-XVnOvf1i28tn_65jcBHZLXZvnrKqskFynmDQqsoW0cBiwrw7UKqZryY7x8Xgy9fzvFwaIUaPb4i9uWDjPPuBgE24H6Q2GP8pjvM44VPU82QpYBNmmdpgfJbjPE7IMpsnSwGbMMvUBuOzHOdxQpb5PFkK2IRZpjYYn-U4j4n-7lwBPpJv7cFT1Em8PB_kZJ6oP_i9PbotfXN222H6nw-drrtgyIf-LvY_7g79rfMC_xUjK9YXYvwo1qx4xZMzVpzz4pwVF_yyC1a85skrVrzhyesp4g0fVcGv-yvfkqVQE75kQk-QbxlqAc73TEgb-aKh0DTkqyY557uGwjeCfNsk53zdcCPAhcIJcL5wWiic5gsnONfCtiYUTvOFk3ZFvnBaKJy-bW-rT5_-BAAA___KYcxq

query I
(SELECT x FROM xyz ORDER BY y) UNION ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
1
1
2
2
3
3
4
4
5
5

# Only one distinct processor should be used in the single node UNION case.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) VALUES (1), (2) UNION VALUES (2), (3)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzEjz9LxTAUxXc_RTmTQoa2OmUScXmLioOLZCjJ5RmsScm9AeGR7y4vGZ4VK4iDY87N7_w5IERHd9MbMfQzBhiFJUVLzDEdpfZh596hewUflixH2SjYmAj6APEyEzSepjkTQ8GRTH6uflfdTXc-dvYlh1e-gCkKMcvJg2XaE3Rf1D_nnOxziMlRIrdKMOWbJreexQcr6y7Xw2b-8Judj8RLDExfemwtMwrk9tTGcMzJ0kOKtsa0533lquCIpV3H9tiFeqoFP8PDX-DxR_hyBffFlLOPAAAA__9xete1

query I rowsort
VALUES (1), (2) UNION VALUES (2), (3)
----
1
2
3

subtest Intersect

# Basic INTERSECT ALL and INTERSECT case -- should return every row.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) INTERSECT ALL (SELECT y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclkGL2kAUx-_9FPJOLZ2CM-q6BgqWslBh0aLeSg5ZM1XBdcIkwtrF7140S20S8_4Os4fgbV3ze_Py8nv-80pbE-tx9KxTCn6RJEGKBHVIUJcE9SgUlFiz0Glq7PGSHBjFLxS0Ba23yS47_jsUtDBWU_BK2TrbaApoHj1t9FRHsbYkKNZZtN6cDkns-jmy--HL_g8JmuyyoDVUFB4EmV32Vu9c5mnfWkXpqlhiKCk8hILSLFpqCuRBNLIvVdvXuc5ua2ysrY4LlcIjiS65cHM_onQ109kkKfY13yc6aI3G84fp7OH7vPXt8ZEEbfTv7ONQfvpq18vV6a9_9y1L932-p47LrGfGZuUxD-Xn2uLdKwZ2aRZvRS90MDZfTFIe7cWze4WzZWMkkg3tS9X2dStyg1n7ya0a8yBlQ_tStX3dimBg1n6CdRrzIGVD-1K1fd2KYGDWfoJ1G_MgZUP7UrV93YpgYNbv9_53ofhUp4nZpvqqt7v2cVo6Xup8-qnZ2YX-ac3idEz-cXLiTrkf6zTLv1X5h9E2_-rY4PVw3weW0ovuedEDnpYOM1NucN8HLs3Mle550QOeVmW6_T_dKcDtMtxh4S7_tLosrCR_dM9nP3gY7AcPo_0ANNgPQIP9uPPZDx4G-8HDaD8ADfYD0GA_-qyl97yk9z77MfAxnIeB4TyMDAc0MBzQKAFcYrP6S-qSm640DAGn5HTGgeaykiIFVaXiRZd8jADTZSVHXFQHNHAd0Eh2hAPbEY50r2Sok-48jXTnaag7wJHuAEe6V4K0qPsd0L2SKU66VzLFSXeeRrrzNNQd4Eh3gCPdK3nqpDtPI915GuoOcKQ7wJHulVQtvmu3ed1VJVtY3cPDh78BAAD__2-CMEY=

query I
(SELECT y FROM xyz) INTERSECT ALL (SELECT y FROM xyz) ORDER BY y
----
1
1
1
2
2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) INTERSECT (SELECT y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmN9r2lAUx9_3V8h52lgG3h9GKwwcW2GF0o7Wt-FDau5qwJqQXKGu-L8PdcwmMedrdkuib6vuc889597vh8QXWsShuQmeTEbDnyTII0keKfJIk0c9mniUpPHUZFmcbv7LDrgKn2nY9ShaJEu7-Xji0TRODQ1fyEZ2bmhI4-Bhbu5MEJqUPAqNDaL5tkiSRk9Buho9r36TR7dLO-yMJE3WHsVLu18vs8GjoaFYe8fX_BZlNlpMbb7gSPyrIwp19ujDqjMLslmJnKz3e5F19vJG_asT6l9X7mW_znIRp6FJTZhbabvK0butmkWv5fq-Q33vv7b4Pchm98beJvk9jleJGXaubsaXd_eXX8edL9fX5NHc_LLvR-LD5zR6nG3_VXnu-576de7XfZza4nUeiY-Viw-OGNihWfxd9MAObuJPcVIc7cHaF7naogVZgZqNyqqZ_tUJ9a8r99KGrJqv7zvUPw9ZgfvlJivZgjBAzUaF0Uz_6oT615V7aUMYzdf3HeqfhzDA_XIThmpBGKBmo8Jopn91Qv3ryr20IYzm6_sO9c9DGOB-uQlDtyAMULNRYTTTvzqh_nXlXtoQRvP1fYf65yEMcL_e7veTA4vfmSyJF5k56teR7mZaJnw0u-ln8TKdmh9pPN2W2f15u-W2H4Qms7tvxe6Pq8Xuq80GX8OiCIvXsM7Boh4slAsthRN94UKrPk9LduKKn7hiS_f4yjwswHnxtJQutOo60QOe1uzEfR7u1YBlEfZZuM-fdZ-FQc8DFtYg2Be8FbpACyWp1PICT0Mx8Dg0A8CRGngcuUGU1JIfvASDL7mljh4AjfwAcCQIgCNDIBzERZQMkx88Gh2vmAJe0oTgJSN8cOy8ZlDrvGfEABQvmaZW2Hkahp3HYdgBjsLO4zDsvGUlsKzkVQNuLKBR2AGOwg5wFHaEgxsvectKcOkk_wRXwEthl7xqpAbHzqsGtc6bRgLTyJJp6oQd0CjsAEdhRzgIO8DhUz9vWQksK3nVoLADy6JzA5pEYQeaRGEHOLrxvGUVuDWKf0Eu4KWwK141CjzQKV41oHXFm0YB06iSaeqEHdAo7ABHYUc4CDvAUdgVb1kFLKt41aC3fGBZdG5Ak-g9H2gSvegDHN143rIKHTv_1lzAy2HnVaPBA53mVVNsfbJ-9ycAAP__wv7M6w==

query I
(SELECT y FROM xyz) INTERSECT (SELECT y FROM xyz) ORDER BY y
----
1
2

# INTERSECT ALL and INTERSECT with MergeJoiner.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) INTERSECT ALL (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcl1GL2kAUhd_7K-Q-tewUnEl0u4GCpeyDsNWivhUfsuZWBdcJkxHWLv73ooG6UTPHMNWAb6vJl3PvzT1z1jda6oR78QtnFP0iSYIUCQpIUEiCWjQWlBo94SzTZntLDnSTV4qagubLdGW3X48FTbRhit7Izu2CKaJR_LzgAccJGxKUsI3ni51IauYvsVl3Xtd_SFB_ZaNGR9F4I0iv7P55mY2nTJHciPM1h9rYQ7mOvDt4-P7-53VjFmezQ4DGm30BqkoB_6npoO6mw9IC9s_RJmHDyUnhs-460csPNlMesu2nRWC0TjlqdHujx8Hw8fuo8e3piQQt-Lf92JF3n76a-XSW__lvurJ0ui2_5k6U3dOfdbHiMu12QVvWYCGgeXkLXafpoO6mw9ICbs5CqoY1BpqXX-PrNB3U3XRYWsDNrXFQwxoDzcuv8XWaDupuOiwt4ObWOKxhjYHm5df4Ok0HdTcdlhZwc2sMfvUMOEv1MuOz_utubnviZMr5pDK9MhP-afRkJ5N_7O-43RcJZza_KvMP3WV-aVvge1gewvI9HBZgWQ2WTS-65UMrL20FtJVz4oF74kGFiatq8MHEq9ItH1p5aSugHTonDl5Xywmrtvt9tZ30vRu-97GXG0b2AjSYmZtG9gI00P7inPiDe-IPPvZyw8hegAYr7qaRvQANtKU7Q9BRfHSaFhNIgQg6Ok4rZZCbhiEEcNS6G4cxBHCkfnSoFgcfgsEfnapVvAJoZBaEo41148guCEfq7khBr80dKRJkivQKFUBDv_jFCsChX_yCRbqTRYJokV7ZAmjoF790ATj0i1--KK98Ue58USBflFe-ABr5BeGodb98QThSd-eLAvmivPIF0MgvCEcb65cvCEfq1fJlvPnwNwAA__-jPjVW

query I rowsort
(SELECT y FROM xyz ORDER BY y) INTERSECT ALL (SELECT y FROM xyz ORDER BY y)
----
1
1
1
2
2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) INTERSECT (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmM1u4kgUhffzFOiuZhSPRP3YMZZGYtSdRaR00krYtVgQXE2QCLZsI4WOePcWeEGw8T12O-BiF36-uqeOnU-F32kZheZ-8mpSCn6QIIckOaTIIU0OuTR2KE6iqUnTKNl-JQduwzcK-g7Nl_Eq2749dmgaJYaCd8rm2cJQQKPJ88I8mkloEnIoNNlkvtgNiZP56yRZD9_Wv8ihh1UW9IaSxhuHolW2Xy_NJjNDgdg49Wc-RUlWHDcUV5WLyyaLf52n2Xw5zYrLbzeRhCYxYdDLX-22JApT9ws9r3svk_SltM54s0-mmiT7pKr1Kat2ra3aq0y2XyfKpx7b7p_Hr6rq2rZAfo1Aq-WxSOMtib5yJPA3k8zMk8ke4sPIo3Vsgt7t_ejm8enmy6j3_90dObQwP7O_h-Lqn_-S-ewl_7Py5thva_DpPd9H_0ZxsYDjWusfDBcduBTMbOdSsHiHLj1P1fqUVbvWVu1VJrPCpRYE8msEuniXyg50Bma20xlYvEOdnadqfcqqXWur9iqTWaEzCwL5NQJdvM5UBzoDM9vpDCzeoc7OU7U-ZdWutVV7lcms0JkFgfwagS5eZ7oDnYGZ7XQGFu9QZ-epWp-yatfaqr3KZFbozIJAfo1AF68z8Cz50aRxtExNrcdy_e2eTDgzeUdptEqm5nsSTXdj8pcPO273RmjSLP9U5C9ul_lH24AfYcHCkodlERYfYe8AFs1g0YqWbhta6Ta0Vjyt2MY137hmYZeHXTb3NR-bh0UrWoKLzdMKXGye1uBie2zjPg9fN4BlEfZZeMBPHvB3mQesAJyCpMJbRQCtiFZeATQSC8CRWQCO1AJw5BbBy0UAuwheLwL4RbQSDKCRYQCOFANw5BiAI8kI3jICaEbwnhFANKKVaQSvGtkHZwheNRKoRpZU0-gMwtPwEMLj8BTC4_AYwuPIFbKkmsPiFSieV40EqpEl1TRxBaCRKwCOXAFw5AqAI1fIkmoOi0d751VTwEuukLxqgCskbxo5ADcNrxoFVKNKqmniCkAjVwAcuQLgyBUAh79Z-AOdAgc6xatGAdWokmqauALQyBUAR64AOHIFwJErFH-gUyg8r5oCXnKF4lUDXKF40ygf3DS8ahRQjSqpppEreBq6gsehK3gcuoLHkSs0f6DT4ECnedVooBrN_4AC_-yARq4AOHIFwJErAI5cocGDKTSdV00BL7lC86opumK8-et3AAAA__8yDCBM

query I rowsort
(SELECT y FROM xyz ORDER BY y) INTERSECT (SELECT y FROM xyz ORDER BY y)
----
1
2

# INTERSECT ALL and INTERSECT with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) INTERSECT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcll1r2zAUhu_3K8K52pgGlp30w1DIGB0LlHS0udty4cZaY0gjI8vQrPS_D9uFznF63gjVF8ldXfuRjnWek9dPtNapmiYPqqD4F0kSFJKgiAQNSdCI5oJyoxeqKLSpHmmASfpIcSAoW-elrf49F7TQRlH8RDazK0UxzZK7lbpRSaoMCUqVTbJVvUlusofEbMaPm78k6Hu2ssrEg7Ec_C6DIFoMwjiOJ9MZCboubXWD5s-CdGlf9nrd4m4zWCbFsr18_fxcUGGTe0WxfBa916wu3rno8M2iX9cp19qkyqi0tdK8ItEjO978R1Isb5W9ztt1zTa5igeT6ezy5vby22zw9eqKBK3UH_txLD9dmOx-Wf_15nu_vlPk0ohbbex2D8by85uLD_c4sF1n8bLojgqm-ovOt492596j1t7yAKein5p7ngp5hFMBGuE3FeEBmtlPzT2bGR6hmaARfmZGB2hmPzX3bGZ0hGaCRviZOTxAM_upuWczh0doJmjE-33j7lj8RhW5Xhdqry_YoDotld6r5vQLXZqF-mn0ot6mubyuufoTJVWFbe6GzcVk3dyqCtwfPvWBpfSiR170OU9LhzML3eBTH3jrzFzpkRd9ztPhNh38T0ctONiGIxYe8t0asnAo-a1HPvPBw2A-eBjNB6DBfAAazMeJz3zwMJgPHkbzAWgwH4AG83HKWnrGS3rmMx_nPobzMDCch5HhgAaGAxolgEtsdn9JXXLTlYYh4JSczjjQXHZSpKWqDHnRJR8jwHTZyREX1QENXAc0kh3hwHaEI907GeqkO08j3Xka6g5wpDvAke6dIG3rfgJ072SKk-6dTHHSnaeR7jwNdQc40h3gSPdOnjrpztNId56GugMc6Q5wpHsnVdvf2gGve9jJFlb3-fOHfwEAAP__LPh79Q==

query I
(SELECT x FROM xyz WHERE x < 2) INTERSECT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----


query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) INTERSECT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmNFu2koQhu_PU6C5OkfHldhdY4ilSFRtqiJFpEq4a7lw8DZYIhjZixQa8e4VUInYxvPjbLHhroF-nvHs_J9sXmkeh3oYPOuU_O8kyCFJDilyyCWHOjR2aJHEE52mcbL5LztgEL6Q33Yomi-WZvPx2KFJnGjyX8lEZqbJp1HwONP3Ogh1Qg6F2gTRbFtkkUTPQbLqv6x-kUNfopnRid_qi9aPZbutJi3p-_5gOCKH7pZm8wWN1w7FS7OvlZrgSZMv1s7x_XyOUhPNJybbTF-U1tmjj6vWNEinBXK83vciq_Tyztno6wrDUWc0HLe0l_11lvM4CXWiw8yVtlc5utuyWXQaru9Z1Hfe1eLXIJ0-aHO3yPY4Wi203xoMRzf3DzefRq2Pt7fk0Ez_NP_2xX_XSfQ03f7riP3qVtmvhzgx-V3vi_9LL947YmCHZvHnogc6GMYf4kV-tAdrX2VqizOzHOinVsudZjYWlmt2OG5pL01Yrv76nkX9y7Ac2C87y8kzMw3op1bTnGY2FqZpdjhuaS9NmKb--p5F_cswDdgvO9OoMzMN6KdW05xmNhamaXY4bmkvTZim_vqeRf3LMA3YLzvTuGdmGtBPraY5zWwsTNPscNzSXpowTf31PYv6l2EasF9_7zeiAxe_1-kinqf6qF-A2ptp6fBJ76afxstkor8l8WRbZvfn3ZbbfhDq1Oy-Fbs_BvPdV5sG38IiD4u3sJuBRTVYKBtaCiv6yoZWXZ6W7MQVP3HFlu7wlXlYgPPiaSltaNW2ons87bIT93i4UwGWedhj4S5_1l0WBvfcY2EXBPuKt0IbaKEglUpe4GkoBh6HZgA4UgOPIzeIglqyg5dg8AW3VNEDoJEfAI4EAXBkCISDuIiCYbKDR6PjFZPDC5oQvGSEB46d1wy6dd4zogeKF0xTKew8DcPO4zDsAEdh53EYdt6yElhW8qoBGwtoFHaAo7ADHIUd4WDjJW9ZCZZO8k9wObwQdsmrRrrg2HnVoFvnTSOBaWTBNFXCDmgUdoCjsCMchB3g8Kmft6wElpW8alDYgWXRuQFNorADTaKwAxxtPG9ZBbZG8S_IObwQdsWrRoEHOsWrBty64k2jgGlUwTRVwg5oFHaAo7AjHIQd4CjsiresApZVvGrQWz6wLDo3oEn0ng80iV70AY42nresQsfOvzXn8GLYedW44IHO5VWTv_Xx-p_fAQAA__-FJxip

query I
(SELECT x FROM xyz WHERE x < 2) INTERSECT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----


# INTERSECT ALL and INTERSECT with some overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x < 3) INTERSECT ALL (SELECT y FROM xyz WHERE x >= 1) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcll9r2zwUxu_fT2HO1TumgWUn_WMoZIyOBUo62txtvnBjrQmkkZFlaFby3Ufiss52ep4K1RfJXV37Jx1Jv5NHT7TSuZpkD6qk5AdJEhSRoJgEDUjQkFJBhdEzVZbabD-pgXH-SEkoaLEqKrv9dypopo2i5Inswi4VJTTN7pbqRmW5MiQoVzZbLHeTFGbxkJn16HH9mwR9XSytMkkwksHPKgzjWRAnSTKeTEnQdWWTYBRRuhGkK_s818sUd-tgnpXz5vAjSekmFVTa7F5RIjei95rVRSDftejo1aJfxqlW2uTKqLwxUrol0Sd7Vv4tK-e3yl4Xzbqm60IlwXgyvby5vfwyDT5fXZGgpfpl_x_JDxdmcT_f_fV33bK17pc1xS4HcauNbZ_BSH58dfDBGzZs3148D7qngon-pIv21u6de9iYWx5gV_RTc89dIY-wK8BB-HVFdIBm9lNzz2ZGR2gmOAg_M-MDNLOfmns2Mz5CM8FB-Jk5OEAz-6m5ZzMHR2gmOIj3u-PuGfxGlYVelepNN9hwu1sqv1f17pe6MjP13ejZbpr68XrH7a4ouSpt_TaqH8ar-tW2wLfDpz6wlF700Is-52npsGeRG3zqA7f2zJUeetHnPB216fBfOm7AYRuOWXjAn9aAhSPJTz306Q8eBv3Bw6g_AA36A9CgP058-oOHQX_wMOoPQIP-ADToj1PW0jNe0jOf_jj3MZyHgeE8jAwHNDAc0CgBXGKz-0vqkpuuNAwBp-R0xoHmspMiDVVlxIsu-RgBpstOjrioDmjgOqCR7AgHtiMc6d7JUCfdeRrpztNQd4Aj3QGOdO8EaVP3E6B7J1OcdO9kipPuPI1052moO8CR7gBHunfy1El3nka68zTUHeBId4Aj3Tup2rxrh7zuUSdbWN3TzX9_AgAA__8PbXv_

query I
(SELECT y FROM xyz WHERE x < 3) INTERSECT ALL (SELECT y FROM xyz WHERE x >= 1) ORDER BY y
----
1
1

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x < 3) INTERSECT (SELECT y FROM xyz WHERE x >= 1) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFv2kgQx9_vU1jzdKfzSeyuMcRSJE5tqiJFpEp4a3lw8DZYIhjZixQa8d0roCrBxvPH2WLDWwP9ecaz8__J5pVmSaQH4bPOKPhKglyS5JIilzxyqU0jl-ZpMtZZlqTr_7IF-tELBS2X4tl8YdYfj1waJ6mm4JVMbKaaAhqGj1N9r8NIp-RSpE0YTzdF5mn8HKbL3svyB7n0KZ4anQZOTzjfFq2WGjsqCIL-YEgu3S1M4PQkjVYuJQuzq5WZ8ElTIFbu8f18jDMTz8Zmv5me-F1H5Ors0MelMwmzSYEcrXa9yCq9vHM2-toRRw9HndFwvNJedtdZzJI00qmO9q60ucrR3ZbNot1wfd-ivvuuFj-H2eRBm7v5fo_D5VwHTn8wvLl_uPkwdP6_vSWXpvq7-bsn_rlO46fJ5l-l5767p06V_XpIUpPf9Z74t_Ti3SMGdmgWvy56oINB8l8yz4_2YO2rvdrizCwH-qnVcqeZjYXlmh2OV9pLE5arv75vUf8yLAf2y85y8sxMA_qp1TSnmY2FaZodjlfaSxOmqb--b1H_MkwD9svONOrMTAP6qdU0p5mNhWmaHY5X2ksTpqm_vm9R_zJMA_bLzjTemZkG9FOraU4zGwvTNDscr7SXJkxTf33fov5lmAbs15_7jejAxe91Nk9mmT7qF6DWelo6etLb6WfJIh3rL2ky3pTZ_nm34TYfRDoz22_F9o_-bPvVusG3sMjD4i3s7cGiGiyUDS2FFX1lQ6sOT0t24oqfuGJLt_nKPCzAefG0lDa0alnRXZ722In7PNyuAMs87LNwhz_rDguDe-6ysAeCfcVboQW0UJBKJS_wNBQDj0MzABypgceRG0RBLfuDl2DwBbdU0QOgkR8AjgQBcGQIhIO4iIJh9gePRscrJocXNCF4yQgfHDuvGXTrvGdEFxQvmKZS2Hkahp3HYdgBjsLO4zDsvGUlsKzkVQM2FtAo7ABHYQc4CjvCwcZL3rISLJ3kn-ByeCHskleN9MCx86pBt86bRgLTyIJpqoQd0CjsAEdhRzgIO8DhUz9vWQksK3nVoLADy6JzA5pEYQeaRGEHONp43rIKbI3iX5BzeCHsileNAg90ilcNuHXFm0YB06iCaaqEHdAo7ABHYUc4CDvAUdgVb1kFLKt41aC3fGBZdG5Ak-g9H2gSvegDHG08b1mFjp1_a87hxbDzqvHAA53HqyZ_66PVXz8DAAD__8_yGLM=

query I
(SELECT y FROM xyz WHERE x < 3) INTERSECT (SELECT y FROM xyz WHERE x >= 1) ORDER BY y
----
1

# INTERSECT ALL and INTERSECT with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz INTERSECT ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcllGL2kwUhu-_XyHn6itMwUnU1kDBUhYqLFpc70ousuZUBTcTZiawdvG_lyRdbNSes-GkIF6OyTPzzskDvi-QmRRnyRM6iL6DBgUBKAhBwQAUDCFWkFuzQueMLV-pgWn6DFFfwTbLC1_-HCtYGYsQvYDf-h1CBMvkcYcLTFK0oCBFn2x31SG53T4ldj953v8EBfPCR72JVpMA4oMCU_jfWx53etz3NonbNHd5RWIFzidrhEgf1D9KF6iJlqYL_pruuFWRGZuixbSxWVyS3CsXrvg1cZsH9PO8GW25zzHqTWfLu8XD3Zdl7_P9PSjY4Q__f5X63Se7XW9eF9QXOl4uFFzuQvKZeW_y0xlcPHjQOFhftZFdpuveSH3LRgZXLUaX6boXI7hlMcKrFqPLdN2LEd6yGIOrFqPLdN2LMbhlMZheuUCXm8zhm9pLv7wZpmusJ-VMYVf4zZpVdUy9nFdc9f-covP106BeTLP6URnw7fBIAo8lsBbl1kOa1i1GFrSDRxJ4LIG1KPfJyM7o4JTu_0mH9LxDEtbNmfVP6YFEcBpmBKdhRnAa5gRnaEbwoURwGmYEp2FGcBrmBGdoRvCRRPAPEkVpmFGUhhlFaZhTlKEZRT9KFKVhRlEaZhSlYU5RhmYUHUsU1aKewNCMpAzNWMrQnKYcznUFWVmQtQVZXRD2BVlh0KLGoM8qQytbaZqzlaY5W2matZXBOVvblKXzb9amLbWlOVtb9aXWOGfrWXkgbY0P__0KAAD__0nZRCY=

query II rowsort
SELECT x, y FROM xyz INTERSECT ALL SELECT y, x from xyz
----
1 1

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz INTERSECT SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmNFq2zAUhu_3FOFcbaBBJDluahhkbIUVSjva3I1cuLHWGNLY2A40K3n3kZiRxqrPH80BJZdO-vkcner7LeeVFllibuNnU1L0iyQJUiRIk6CABA1oIigvsqkpy6zY_EkNXCcvFPUFpYt8WW0-ngiaZoWh6JWqtJobimgcP87NvYkTU5CgxFRxOt8WyYv0OS5Wo5fVHxJ0t6yi3kiKkaLJWlC2rHa3LKv4yVAk1-Lwst_TskoX02q_Zl2Aqba7weOqN4vL2Xv8ZL1rSrk05TQLJUaydRb6FGcRtDa1u9VykRWJKUyyd7PtXVzabpvLwH8LYYcWxH91-SMuZw-musv32xyvchP1rm_HV_cPV9_Gva83NyRobn5XH7cr-PSlSJ9m_y4Oc_DiuPO9zT5neXMG7xYe7hWWfjIHlPWTOcechUPmnMgsgtamPGWOlxbCDi2cWeYoP-qDsn7UP-YsHNQ_kVkErU15Ut9LC2GHFs5Mfe1HfVDWj_rHnIWD-icyi6C1KU_qe2kh7NDCmakf-FEflPWj_jFn4aD-icwiaG3Kk_peWgg7tHBm6oMft-5NmWeL0hz0K0J_szKTPJl6UmW2LKbmZ5FNt2Xqy7stt_0gMWVVfyvri-tF_dWmwbewbMLyLRzswdINlqoTfdmFVmEXWmueVuzENT9xzZYe8JV5WIK-eVr1O9EXXWgNdlrAThz8swcOsGrCIQuDRV_wGyXkd8qQpS95-LKL2DyMxAY0EJunkdg8jcSWIEtRmPKxAtwGNJIb4MhuhIOdDnDkt-QjVSLcShcOtxyXfLygpfP5IoHl0koYp0cwT8NnMMDRQ5jH4VOYx6GtfLzKIRi8la9OtvI0tJXHoa0AR1uWx6GtVsruDV5JcHziU7aBW7YqK2pcbFV80ihwelP8OQYMDtDIVoQDWwGObAU4PDTzIasGYPBWyrrYCmhkK8CRrQhHW5bHka2KP8KqIcD5lG3gtq38KRYtnU8a3QfvWlbSuNgKaGQrwoGtAEe2AhzZqvmQ1QoM3kpZp7dcnoavuTwO33MBjl50eRzZqvmjrEaj41O2gVu2av4s21z6ZP3hbwAAAP__Xj30yw==

query II rowsort
SELECT x, y FROM xyz INTERSECT SELECT y, x from xyz
----
1  1

# INTERSECT ALL and INTERSECT with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcmFFr4kAUhd_3V8h92qWz0JlEbQMLLkthC6VdWt8WH1Izq4J1ZBKhbvG_L-qD1TT35CZiFt-q5sudnvQ7M_aNZi6x9_GLTSn6TZoUGVIUkKKQFLVpoGju3dCmqfPrS7bAbfJK0aWiyWy-yNZvDxQNnbcUvVE2yaaWIurHz1P7aOPEelKU2CyeTDdD5n7yEvtl73X5lxQ9LLKo1dOqZ2iwUuQW2e6WaRaPLEV6pcqPfXI-O5zYMxfcpB38vGyN43R8QGsarHarMZLVSEMICkMI_qsQwsLV7O7jfGK9TfKrGKzhEld98Iv9jNPxk80e5vvX95dzG7Vu7_s3j083P_qt73d3pGhq_2Sfe_rLNz8ZjTc_7QIozLldO2d9UXjzTuXYdEEg9-6r2w-jaHZ3b7ZuRl4w9sTyHjmEsvI2HUJYuJrzkrdKzqXlNc0IBMaeWKAjh1BWoKZDCAtXc14CVcm5tEBBMwKBsScW6MghlBWo6RDCwtWcl0BVci4tUNiMQGDsiQU6cghlBWo6hLBwNeclUJWcK33_-uDmjzadu1lqS327ulynZZOR3T6D1C380P7ybrgZs335sOE2byQ2zbaf6u2L29n2o_UC38P6ENbv4XAP1jJY61p0tw5tglr0NU8bNvGATzwQJG5k8EHiUrpbhz5IXEpf83TIJt7mE2-zcId_1h3-WQO9uix9xcNXddzkYeQmoIGbPI3cBDRw85pvw0tQh7kyldgJaKQnwoGfAEeCIhwYqnOVuh-8AcHznQok1bl22R8eguG5ehHtgjwNt0GAo32Qx-FGCHBgm-a7VXdA8Ll2FenG01A3gCPdeBzqBnCkG7-zaLC16FzJinTjS9aAkjWSks0fvkQlK8aBbgBHuiEcHTz5kjWgZE2uZCW6ARrphnCgG8CRbggHuhl-gzFggzH8-RXoZviSNaBkjaRk88NFJSvGkW6ikhXjSDe-ZA0oWSM5wOf_5EQneDGOdBOd4cU40o3fYAKwwQT8v0QOdRusPv0LAAD__yyMVsE=

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
2
3
4
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzU2N9r2l4Yx_H7718hz9V39Aw8P5KqMHBshRVKO1rvhhepOauCNZJEqCv-70MdWH_k-SSemOjd2u6d5-xp8iLznSZRaO-DV5tQ5xdJEqRIkCZBhgR51Bc0jaOBTZIoXv6VdXAbvlGnKWg0mc7S5bf7ggZRbKnzTukoHVvqUC94HttHG4Q2JkGhTYPReDVkGo9eg3jefZv_IUEPs7TT6ErRVdRfCIpm6eaSSRq8WOrIhcg_9imK092JXXWVb5IqMun7KElHk0G6M0tuRu3M2aTP88YwSIZ7ZX-xOYsucpaiy9aZKzCVLds7o2X7mWfZXGc2ieLQxjbcutLqKrlPm7WL65rntxzmi6OO-CNIhk82fZhun7E3n9pO4_a-d_P4dPOt1_h6d0eCxvZ3-n9XfvoSj16Gqz9l_t43_6a2850sr7JNaubY2KFl_LvqgSPcR5-j6e5uDw_fFlHWAzEYWyLEYFKlEJe87LwQn3LZ3hkt2888Sx0QVz-_5TD_MiA-5k7OD7Gqx0IwtkQLwaRKLSx52XktPOWyvTNatp95ljosrH5-y2H-ZVh4zJ2c30Jdj4VgbIkWgkmVWljysvNaeMple2e0bD_zLHVYWP38lsP8y7DwmDs5v4WmHgvB2BItBJMqtbDkZee18JTL9s5o2X7mWeqwsPr5LYf5l2HhMXfycR9WHrj6o02m0SSxuT6KbC7XZcMXu15_Es3igf0ZR4PVmPWXD6tu9Y3QJun6p3L9xe1k_aPlAT_Gko0VH6vdWH6M_a1YFovltUutnGrtVBtQa3bjht-4YWOPjz323ODYfCxbLrVyqrVTbUDtsxsH8XWBWO3GLTZu87_rNo9Ckz-35E3xECq8KhKwIvcesO1cg3zvCSvCEqiRSyBHMIEcyQRyRJPkeZHAF7n3pG3nPsj3HrUiPoEaAQVyJBTIEVEgR0ZJ3hnZBjkvzU6-55TkrVFN8BIB3l8AVQq8waBXGN4aBaxRTtaAGr4DuVkDcvgW5GaN4q1RwBrFW6OANcrJGlAja0COrAE5sgbkyBrFW6OANYq3RgFrFG-NBtZoN2s0b40G1mjeGg2s0U7WgBpZA3JkDciRNSCH_-XirdHAGs1bo4E12skaUCNrQI6sATmyBuTIGs1bo4E1mrdGA2s0b40B1hg3awxvjQHWGN4aA6wxTtaAGlkDcmQNyJE1IEfWGN4aA6wxvDUGWGOcrAE1sgbkyBqQI2tAjqwxvDUGWGN4awywxvDWeMAar6A1_cV_fwMAAP__kFPy3Q==

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY z) ORDER BY x
----
1
2
3
4
5

# INTERSECT ALL and INTERSECT with different numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcmM1q20AUhfd9CnNXLZlCZiTbiaCgUgINhKQk3hUvFGsaGxyPGckQN_jdi-WFY6m-R1f-A-_in093cpTvzCjvNHGpvU9ebUbRb9KkyJCigBSFpKhNfUVT7wY2y5xffmUF3KZvFF0qGk2ms3z5dl_RwHlL0Tvlo3xsKaJe8jy2jzZJrSdFqc2T0bgYMvWj18TP47f5X1L0MMujVqxVbKi_UORm-fqSWZ68WIr0QtUf--R8Xp4Ymwtu0hp-nreGSTYs0Zr6i_VqjGQ14hBUHGzNIdhDDioOLsBAWRzh1kWtr-N8ar1Nqzelv4TRt4olFyPLv-PPJBs-2fxhusn05lMbtW7vezePTzc_eq3vd3ekaGz_5J9j_eWbH70Mi5_WOWyNvL1z5Ppi68U7jaPTWwK5d1_dZhjbZnc3ZuvTqAzGHlnlfYdQX-VmORxYZX3WKjeJvLbK5jQ6gbFH1mnfIdTXqVkOB9bJnLVOTSKvrVNwGp3A2CPrtO8Q6uvULIcD6xSctU5NIq-tU3gancDYI-u07xDq69QshwPrFJ61Tk0ib_Tc9p-LP9ps6iaZrfVUdrlMy6YvdnUfMjfzA_vLu0ExZvXyoeCKN1Kb5atP9erF7WT10XKBH2FdhvVHONyAtQzWeie6uwttgp3oa542bOIBn3ggSNzI4FLiUrq7C11KXEpf83TIJt7mE2-zcIe_1x3-XgO9uix9xcNXu7jJw8hNQAM3eRq5CWjg5jXfhpegDitlKrET0EhPhAM_AY4ERTgwVFcqdTN4A4LnOxVIqivtsjk8BMMr9SLaBXkaboMAR_sgj8ONEODANs13q-6A4CvtKtKNp6FuAEe68TjUDeBIN35n0WBr0ZWSFenGl6wBJWskJVs9fIlKVowD3QCOdEM4OnjyJWtAyZpKyUp0AzTSDeFAN4Aj3RAOdDP8BmPABmP48yvQzfAla0DJGknJVoeLSlaMI91EJSvGkW58yRpQskZygK_-yYlO8GIc6SY6w4txpBu_wQRggwn4f4mUdesvPv0LAAD__3jhZNY=

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
1
2
3
4
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzU2F9r2mwYx_Hz51XIdfQ89H7A-4-pCgPHVlihtKP1bHiQmntVsCYkEeqK732oA2s01y_JHZJ5trb75rp3NfmQ-U7LMLD3_qtNaPiDJAlSJEiTIEOCejQRFMXh1CZJGG__yj64Dd5o2BU0X0ardPvtiaBpGFsavlM6TxeWhjT2nxf20fqBjUlQYFN_vtgNieL5qx-vR2_rXyToYZUOOyMpRoomG0HhKj1cMkn9F0tDuRHFxz6FcZqdOFJXxSapMpO-zpN0vpymmVnyMCoz55A-rzszP5mdlJPN4Sy6zFlKL1uMdO4WTA37FiN9VXhg7y9au5d7lsN1VsswDmxsg6Mr7a5S-LR5u7hueX7fYb6odMRvfjJ7sulDdHzG8Tqyw87t_fjm8enmy7jz-e6OBC3sz_TfkfzvUzx_me3-lPt7P_ybBs43tLzK16lbYGPnlvHnqmeOcB_-H0bZ3Z4ffmyjbIdkMLZGksGkRkmue9nFSa62bweS2127l3uWNkhufn7fYf5lkFzlhi5OsmpHRTC2RhXBpEZVrHvZxVWstm8HFdtdu5d7ljZUbH5-32H-ZahY5YYurqJuR0UwtkYVwaRGVax72cVVrLZvBxXbXbuXe5Y2VGx-ft9h_mWoWOWGLq6iaUdFMLZGFcGkRlWse9nFVay2bwcV2127l3uWNlRsfn7fYf5lqFjlhq72oeaZqz_aJAqXiS30kWV3uy4bvNj9-pNwFU_t9zic7sbsv3zYdbtvBDZJ9z-V-y9ul_sfbQ_4MZZsrPhYZWP5MfaOYlkultcutXKqtVNtQK3ZjRt-44aNe3zcY88Njs3Hsu9SK6daO9UG1B67cRBfl4hVNu6z8YD_XQ94FLr8uSVvSg-hwqsiASvy5AE7zjXIT56wMiyBGrkEcgQTyJFMIEc0SZ4XCXyRJ0_ace6B_ORRK-MTqBFQIEdCgRwRBXJklOSdkQOQ89Jk8hOnJG-N6oKXCPD-AqhS4A0GvcLw1ihgjXKyBtTwHcjNGpDDtyA3axRvjQLWKN4aBaxRTtaAGlkDcmQNyJE1IEfWKN4aBaxRvDUKWKN4azSwRrtZo3lrNLBG89ZoYI12sgbUyBqQI2tAjqwBOfwvF2-NBtZo3hoNrNFO1oAaWQNyZA3IkTUgR9Zo3hoNrNG8NRpYo3lrDLDGuFljeGsMsMbw1hhgjXGyBtTIGpAja0COrAE5ssbw1hhgjeGtMcAa42QNqJE1IEfWgBxZA3JkjeGtMcAaw1tjgDWGt6YHrOmVtGay-ed3AAAA__9SiP0A

query I
(SELECT x FROM xyz ORDER BY y) INTERSECT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----
1
2
3
4
5

# INTERSECT ALL and INTERSECT with compatible ORDER BY columns that are not in the final result.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcl1GL2kAUhd_7K-Q-tXQKziS63UAhpSxUWLSobyUPWTNVwXXCJMLaxf9eNFDXaO4xzBLFt1XzeW5O7pmzvtLSJLofP-uMgt8kSZAiQR4J8klQhyJBqTUTnWXGbi8pgF7yQkFb0HyZrvLt25GgibGaglfK5_lCU0Dj-GmhhzpOtCVBic7j-WInktr5c2zX4cv6LwkarPKgFSoRehRtBJlVvv_KLI-nmgK5EefLjozNy4qh-vxfSYpQlZT28NO6NYuzWYmWFG3206g607yfCd5VmeBXTrP_HmMTbXVyPEW0hc-46sSN_Yyz2Ujng_Tw-vE61UGr1x8_DEcPP8at74-PJGih_-QfQ_npm51PZ7u_9gZU-tw5485Wy1NTnxy4b76YtHTZaeHugbC8TLiAbMPhaswE76pM8Cunua1wqcvsOJBteMcbM8G7KhP8ymlua8e9y-w4kG14xxszwbsqE_zKaW5rx_3L7DiQbXjHGzPBuyoT_MppbmvHwQ-uoc5Ss8z0Wf_pt7c3pJOpLmzKzMpO9C9rJjuZ4uVgx-3eSHSWF5_K4kVvWXy0HfAtLMuwfAv7B7CsB8u2E91xoZWTtgLainXc4x33ajiu6sElx-vSHRdaOWkroO2zjoPH1WFh1eWfV5el73j4ziVePIziBWjgGU-jeAEaaH9lHb_nHb93iRcPo3gBGqw4T6N4ARpoS75D0FF8dJoeNpACFXR0nNbqIJ6GJQRwdOs8DmsI4Ej96FA9NN4Hxh-dqnWyAmgUFoSjjeVxFBeEI3W-UtBj4ytFgk6RTqUCaJgXt1oBOMyLW7FIvlkkqBbp1C2AhnlxaxeAw7y49Yty6hfF94sC_aKc-gXQKC8IR7fu1i8IR-p8vyjQL8qpXwCN8oJwtLFu_YJwpF6vX6LNh38BAAD__5C5VoM=

query I rowsort
(SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)
----
1
1
1
2
2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcl1GL2kAUhd_7K-Q-tXQKziS63UAhpSxUWLSobyUPWTNVwXXCJMLaxf9eNFDXaO4xzBLFt1XzeW5O7pmzvtLSJLofP-uMgt8kSZAiQR4J8klQhyJBqTUTnWXGbi8pgF7yQkFb0HyZrvLt25GgibGaglfK5_lCU0Dj-GmhhzpOtCVBic7j-WInktr5c2zX4cv6LwkarPKgFSoRehRtBJlVvv_KLI-nmgK5EefLjozNy4qh-vxfSYpQlZT28NO6NYuzWYmWFG3206g607yfCd5VmeBXTrP_HmMTbXVyPEW0hc-46sSN_Yyz2Ujng_Tw-vE61UGr1x8_DEcPP8at74-PJGih_-QfQ_npm51PZ7u_9gZU-tw5485Wy1NTnxy4b76YtHTZaeHugbC8TLiAbMPhaswE76pM8Cunua1wqcvsOJBteMcbM8G7KhP8ymlua8e9y-w4kG14xxszwbsqE_zKaW5rx_3L7DiQbXjHGzPBuyoT_MppbmvHwQ-uoc5Ss8z0Wf_pt7c3pJOpLmzKzMpO9C9rJjuZ4uVgx-3eSHSWF5_K4kVvWXy0HfAtLMuwfAv7B7CsB8u2E91xoZWTtgLainXc4x33ajiu6sElx-vSHRdaOWkroO2zjoPH1WFh1eWfV5el73j4ziVePIziBWjgGU-jeAEaaH9lHb_nHb93iRcPo3gBGqw4T6N4ARpoS75D0FF8dJoeNpACFXR0nNbqIJ6GJQRwdOs8DmsI4Ej96FA9NN4Hxh-dqnWyAmgUFoSjjeVxFBeEI3W-UtBj4ytFgk6RTqUCaJgXt1oBOMyLW7FIvlkkqBbp1C2AhnlxaxeAw7y49Yty6hfF94sC_aKc-gXQKC8IR7fu1i8IR-p8vyjQL8qpXwCN8oJwtLFu_YJwpF6vX6LNh38BAAD__5C5VoM=

query I rowsort
(SELECT y FROM xyz ORDER BY z) INTERSECT ALL (SELECT y FROM xyz ORDER BY z)
----
1
1
1
2
2

# INTERSECT ALL and INTERSECT with a projection on the result.
query I rowsort
SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT ALL (SELECT x, y FROM xyz))
----
1
2
3
4
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT ALL (SELECT x, y FROM xyz))]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclk2L2zAQhu_9FWFOLagQKR9tDIWUstDAkpRsbsUHbzxNDFnLSDJsuuS_F9tdsnZizZq5mBwV-5FejR_I-wKpjnEZPaGF4DdIEKBAwAgEjEHABEIBmdFbtFab4pUKWMTPEAwFJGmWu-LnUMBWG4TgBVziDggBbKLHA64xitGAgBhdlBzKQzKTPEXmOH8-_gUBq9wFg7kUcwXhSYDO3f8tzzs9Hgf7yO7ru7wioQDroh1CIE-ix-lUa7rzVnmqTYwG49pmYUFSr1y54s_I7h_QrbJ6tM0xw2CwWG7u1g93PzaD7_f3IOCAf9zHMvWnbybZ7V8X5xk0BnC-2Yhxsyuxl_qzzpoDuHrwuHaw7NkHl71Op1rT3ZaOqmdzl71Op1rT3ZYVo57NXfY6nWpNd1tWjHs2d9nrdKo13W1ZQRTJNdpMpxbf1ViGxbUw3mE1Jqtzs8VfRm_LY6rlquTK_-QYraueqmqxSKtHRcD3w1MOPOPAkpVbTvy07DAy1Q2ecuAZB5as3I2RXdCqSQ_f0iP_vEdeWNZnNmzSY47gfpgQ3A8TgvthSnCCJgSfcAT3w4TgfpgQ3A9TghM0IfiUI_gXjqJ-mFDUDxOK-mFKUYImFP3KUdQPE4r6YUJRP0wpStCEojOOopLVEwiakJSgCUsJmtKUwqmuwCsLvLbAqwvMvsArDJLVGORFZehkq5-mbPXTlK1-mrSVwClbu5Sly2_WpS11pSlbO_Wlzjhl60V58Noanj78CwAA__92o0EQ

query I rowsort
SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT (SELECT x, y FROM xyz))
----
1
2
3
4
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) INTERSECT (SELECT x, y FROM xyz))]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmNFq2zAUhu_3FOFcbaBBJDluahh0bIUVSjva3I1cuLGWGNLY2Ao0K3n3kZiRxqrPX88lSi6d9PM5OtX3W84zLbLE3MSPpqToF0kSpEiQJkEBCRrQWFBeZBNTllmx-ZMKuEqeKOoLShf50m4-HguaZIWh6JlsaueGIhrFD3NzZ-LEFCQoMTZO59sieZE-xsXq4mn1hwTdLm3Uu5DiQtF4LShb2t0tSxtPDUVyLd5e9nta2nQxsfs1qwJMtd0NHla9WVzOXuPH611Tqk1T7zcLfYyzCBqb2t1quciKxBQm2bvZ9i5t2m6ay8B_C2GHFsR_dfkjLmf3xt7m-22OVrmJelc3o8u7-8tvo97X62sSNDe_7cftCj59KdLp7N_Fbic0ruzsfYd7k33O8voAXi083Css_QQOKOsncA42C32Mswgam_IUOF5aCDu0cEqBo_x4D8r68f5gs9DHOIugsSlP3ntpIezQwil5r_14D8r68f5gs9DHOIugsSlP3ntpIezQwil5H_jxHpT14_3BZqGPcRZBY1OevPfSQtihhVPyHvyadWfKPFuU5k2_HPQ3yzLJ1FRjKrNlMTE_i2yyLVNd3m657QeJKW31rawurhbVV5sGX8KyDsuXcLAHy3awVJ3o8y60CrvQWvO0Yieu-YlrtvSAr8zDEvTN06rfiT7rQmuw0wJ24uCfPWgBqzocsjBY9Bm_UUJ-pwxZ-pyHz7uIzcNIbEADsXkaic3TSGwJshSFKR8rwG1AI7kBjuxGONjpAEd-Sz5SJcKddOFwx3HJxwtaOp8vElgunYRp9QjmafgMBjh6CPM4fArzOLSVj1c5BIN38rWVrTwNbeVxaCvA0ZblcWirk7J7g1cSHJ_4lK3hjq3KiZo2tio-aRQ4vSn-HAMGB2hkK8KBrQBHtgIcHpr5kFUDMHgnZdvYCmhkK8CRrQhHW5bHka2KP8KqIcD5lK3hrq38KRYtnU8a3QfvWk7StLEV0MhWhANbAY5sBTiyVfMhqxUYvJOyrd5yeRq-5vI4fM8FOHrR5XFkq-aPshqNjk_ZGu7YqvmzbH3p4_WHvwEAAP__N8_xtQ==

subtest Except

# Basic EXCEPT ALL and EXCEPT case.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) EXCEPT ALL (SELECT x AS y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclk1r20AQhu_9FWZOLd2CdyXnQ1BwKYEGQhwSHwpFB8Xa2gbHK1ZriBv834utgCvLntfLqmB8iyI9s6PJM3n1RnOT6_vsRZeU_CJJghQJikhQTIJ6lAoqrBnpsjR2_UgF3OavlHQFTefFwq1_nQoaGaspeSM3dTNNCQ2z55l-1FmuLQnKtcums80hhZ2-ZHbZf13-IUGDhUs6fUXpSpBZuPd62zLPy84kKyf1En1J6SoVVLpsrCmRK_Gf-pJBfamDfW3rLObG5trqvFYpXZPokT0v9yMrJ0_aDYp6X8NloZPOzc_vNw_Dzre7OxI007_dx7789NVOx5PNTwdfevtCkc-gn4x1uzPuy88Hi8dHTGvfIN6L7ung3nwxxe5c957dq50tT9TsNvtq02x5bmaDQYeZrU7Urjb7atMudW52gUGH2RWdqF1t9tWmXdG52QUGHWZXfKJ2tdlXm3bF52YXGHR733x7ij_qsjDzUh_1Rdddj0rnY12NvjQLO9IP1ow2x1SXgw23iftcl666q6qL23l1a93g8fBlCCxlEN0Loq95WnrMTPnBlyHwzsx86V4Qfc3Tapfu_ktHNbi7C0csHPN_rZiFleSP7oXsBw-D_eBhtB-ABvsBaLAfFyH7wcNgP3gY7QegwX4AGuzHJWvpFS_pVch-XIcYzsPAcB5GhgMaGA5olAA-sdn8T-qTm740DAGv5PTGgeaykSI1VaXiRZd8jADTZSNHfFQHNHAd0Eh2hAPbEY50b2Sol-48jXTnaag7wJHuAEe6N4K0rvsF0L2RKV66NzLFS3eeRrrzNNQd4Eh3gCPdG3nqpTtPI915GuoOcKQ7wJHujVStf2t3ed1VI1tY3dPVh78BAAD___FqK7k=

query I
(SELECT y FROM xyz) EXCEPT ALL (SELECT x AS y FROM xyz) ORDER BY y
----
1
1
2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz) EXCEPT (SELECT x AS y FROM xyz) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFr2zwUhu-_XxHO1TfmQSQ5TmoYZGyFFUpb2l4MRi7cWEsMaWxsB5qV_PeRZCy1HZ_XnoK13K3JHr060jkPdl5pGYf6JnjWGfnfSZBDkhxS5JBLDg1o4lCSxlOdZXG6_S974Cp8Ib_vULRMVvn244lD0zjV5L9SHuULTT49Bk8Lfa-DUKfkUKjzIFrsQpI0eg7S9fhl_ZMcul3lfm8sabJxKF7lh_WyPJhp8sXGaZ75JcryaDnNi4Fj8SdHlHIO6NO6Nw-yeYWcbA57kW320qr-8r4Omeofqt-t3cthndUyTkOd6rCw0m6VxrutO4uB5XzPIN_5qy1-DbL5g85vk-IeH9eJ9nuX3z5f3j32Pl1fk0ML_SP_fyzefUyj2Xz3rwbNNWzTXA9xmpd7eSze1y4-anBaxw7i96JHdnATf4iT8rkezb4oZAsLpgKZnZrqlPU3NZXd-t3avdgwVff5nkH-GZgKNJeZqaQFW4DMTm1xyvqb2sJu_W7tXmzYovt8zyD_DGwBmsvMFsqCLUBmp7Y4Zf1NbWG3frd2LzZs0X2-Z5B_BrYAzWVmC9eCLUBmp7Y4Zf1NbWG3frd2LzZs0X2-Z5B_BrYAzXW630yOLH6vsyReZrrRLyL97VHpcKb3R5_Fq3Sq79J4uovZ_3m743YfhDrL99-K_R9Xy_1X2w2-hUUZFm9htwCLdrBQJrQURvSFCa2GPC3ZE1f8iSs2esAn87AA98XTUprQqm9Ej3jaZU_c4-FBC1iWYY-Fh_xdD1kY1DxiYRcM9gVvhT7QQkUqrbzA01AMPA7NAHCkBh5HbhAVtRQPXoKDr7iljR4AjfwAcCQIgCNDIByMi6gYpnjw6Oh4xZTwiiYELxnhgWvnNYNK5z0jRiC8YppWw87TcNh5HA47wNGw8zgcdt6yElhW8qoBHQtoNOwAR8MOcDTsCAcdL3nLStB0kn-CK-GVYZe8aqQLrp1XDSqdN40EppEV07QZdkCjYQc4GnaEg2EHOHzq5y0rgWUlrxo07MCy6N6AJtGwA02iYQc46njesgp0jeJfkEt4ZdgVrxoFHugUrxpQuuJNo4BpVMU0bYYd0GjYAY6GHeFg2AGOhl3xllXAsopXDXrLB5ZF9wY0id7zgSbRiz7AUcfzllXo2vm35hJeHXZeNS54oHN51ZRLn2z--xUAAP__dwzIXg==

query I
(SELECT y FROM xyz) EXCEPT (SELECT x AS y FROM xyz) ORDER BY y
----


# EXCEPT ALL and EXCEPT with MergeJoiner.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) EXCEPT ALL (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcl9Fr2lAUxt_3V8h52ugd9N5EuwYGjtGHQldL68Ng-JCaMxWsN9xEqCv-70MDs0ZzPsOdBnyrJr9855yc7371jWY24fv4hTOKfpEmRYYUBaQoJEVtGihKnR1yllm3uqUAbpNXii4VTWbpPF99PVA0tI4peqN8kk-ZIurHz1N-5DhhR4oSzuPJdC2SuslL7Bbd18UfUtSb51Gra2iwVGTn-eZ5WR6PmCK9VIdrPlmXl-W6-qL08M39z4vWOM7GZYAGy00Bpk4B_6npoOmmw8oCNs-xLmHHyV7hg-7a08sPdiN-4ryXbgP9RcpR6-bn95uHfuvb3R0pmvLv_GNXX3z66iajcfHnv9HqytG2D-hsPttX9d6C7-1nm5Zu2y_c2RLWDZgHaB7fPKdpOmi66bCygPMyj2lgh4Hm8Xf4NE0HTTcdVhZwXjscNLDDQPP4O3yapoOmmw4rCzivHQ4b2GGgefwdPk3TQdNNh5UFnNcOg984j5yldpbxQf9pX64a4mTExZgyO3dDfnB2uJYpPvbW3PqLhLO8uKqLD7ez4tKqwPewLsP6PRxuwboerC-96LYPbby0DdA24sQDeeJBjYmbenBp4nXptg9tvLQN0A7FiYPX1RZh05HfV0ekr2T4ysdeMozsBWgwM5lG9gI00P4iTvxanvi1j71kGNkL0GDFZRrZC9BAW8sZgo7indN0O4EMiKCd47RWBsk0DCGAo9ZlHMYQwJH6zqG6PfgQDH7nVK3jFUAjsyAcbayMI7sgHKnLkYJemxwpGmSK9goVQEO_-MUKwKFf_IJFy8miQbRor2wBNPSLX7oAHPrFL1-MV74YOV8MyBfjlS-ARn5BOGrdL18QjtTlfDEgX4xXvgAa-QXhaGP98gXhSL1evgyWH_4GAAD___JTMNE=

query I rowsort
(SELECT y FROM xyz ORDER BY y) EXCEPT ALL (SELECT y FROM xyz ORDER BY y)
----


query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY y) EXCEPT (SELECT y FROM xyz ORDER BY y)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmE1v2koUhvf3V6CzulfxlZgPO8ZSJao2i0hpEiVZVKpYEDwlSARbtpFCI_57BV4QbHxeuy542IWPZ847r51Hg99pEYXmdvxqUgp-kCCHJDmkyCFNDrk0cihOoolJ0yjZfCUHrsM3CvoOzRbxMtu8PXJoEiWGgnfKZtncUEBP4-e5eTDj0CTkUGiy8Wy-HRIns9dxshq-rX6RQ3fLLOgNJY3WDkXLbLdemo2nhgKxdurPfIySrDhuKC4qF5dNFv86S7PZYpIVl99sIglNYsKgl7_abkkUpu4Wel71XsbpS2md0XqXTDVJ9peq1ses2rW2aq8y2W6dKJ96aLt_Hr-qqkvbAvk1Ai0XhyKNNiT6yoHA30wyNY8mu4v3Iz-tYhP0rr5_ubp_6n2-uSGH5uZn9u9QXPz3KZlNX_I_K--M3Z4GLfZ0IPBt9H8UF7d-WGj9vcmiA4uCme0sChbv0KKnqVofs2rX2qq9ymRWWNSCQH6NQOdtUdmBy8DMdi4Di3fostNUrY9ZtWtt1V5lMitcZkEgv0ag83aZ6sBlYGY7l4HFO3TZaarWx6zatbZqrzKZFS6zIJBfI9B5u0x34DIws53LwOIduuw0VetjVu1aW7VXmcwKl1kQyK8R6LxdBp4cP5g0jhapqfUorr_ZkAmnJi8ojZbJxNwn0WQ7Jn95t-W2b4QmzfJPRf7iepF_tAn4ERYsLHlYFmHxEfb2YNEMFq1o6bahlW5Da8XTim1c841rFnZ52GVzX_KxeVi0oiW42DytwMXmaQ0utsc27vPwZQNYFmGfhQf85AF_l3nACsApSCq8VQTQimjlFUAjsQAcmQXgSC0AR24RvFwEsIvg9SKAX0QrwQAaGQbgSDEAR44BOJKM4C0jgGYE7xkBRCNamUbwqpF9cIbgVSOBamRJNY3OIDwNDyE8Dk8hPA6PITyOXCFLqtkvXoHiedVIoBpZUk0TVwAauQLgyBUAR64AOHKFLKlmv3i0d141BbzkCsmrBrhC8qaRA3DT8KpRQDWqpJomrgA0cgXAkSsAjlwBcPibhT_QKXCgU7xqFFCNKqmmiSsAjVwBcOQKgCNXABy5QvEHOoXC86op4CVXKF41wBWKN43ywU3Dq0YB1aiSahq5gqehK3gcuoLHoSt4HLlC8wc6DQ50mleNBqrR_A8o8M8OaOQKgCNXABy5AuDIFRo8mELTedUU8JIrNK-aoitG639-BwAA__-DMhvH

query I rowsort
(SELECT y FROM xyz ORDER BY y) EXCEPT (SELECT y FROM xyz ORDER BY y)
----


# EXCEPT ALL and EXCEPT with no overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) EXCEPT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcll1r2zAUhu_3K8K52pgGlp30w1DIGB0rlLa0uRhsvnBjrTGkkZFlaFb634ftQuc4PW-F6ovkrq79SMc6z8nrR1rpTF2k96qk-BdJEhSSoIgEjUnQhBJBhdFzVZba1I-0wFn2QHEgKF8Vla3_nQiaa6MofiSb26WimGbp7VJdqzRThgRlyqb5stmkMPl9atbTh_VfEvQ9X1pl4tFUjn5XQRDNR2Ecx2cXMxJ0Wdn6BiVPgnRln_d62eJ2PVqk5aK7fPN8Iqi06Z2iWD6JwWtWJ-9cdPhq0S_rVCttMmVU1lkpqUn0yJY3_5GWixtlL4tuXbN1oeLR6c9vp1ez0dfzcxK0VH_sx6n8dGLyu0Xz16sv_fJCkUsXbrSxmw2Yys-vLj5-w2ltO4jnRbdUcKG_6GLzXLfuPensLXdwJIapeeCRkPs2EqALfiMR7qCWw9Q8sJbhvmkJuuCnZbSDWg5T88BaRvumJeiCn5bjHdRymJoH1nK8b1qCLrzfd-2Wxa9VWehVqd701RrUR6WyO9UefakrM1dXRs-bbdrLy4ZrvkwyVdr2bthenK3aW3WBb4cPfWApveiJF33M09LhzEI3-NAH3jgzV3riRR_zdLhJB__TUQcONuGIhcd8t8YsHEp-64nPfPAwmA8eRvMBaDAfgAbzceAzHzwM5oOH0XwAGswHoMF8HLKWHvGSHvnMx7GP4TwMDOdhZDiggeGARgngEpv9X1KX3HSlYQg4JaczDjSXvRTpqCpDXnTJxwgwXfZyxEV1QAPXAY1kRziwHeFI916GOunO00h3noa6AxzpDnCkey9Iu7ofAN17meKkey9TnHTnaaQ7T0PdAY50BzjSvZenTrrzNNKdp6HuAEe6Axzp3kvV7rd2wOse9rKF1T15-vAvAAD__2wwd20=

query I
(SELECT x FROM xyz WHERE x < 2) EXCEPT ALL (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
1

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz WHERE x < 2) EXCEPT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFr2lAUx9_3KeQ8bSwD770x2kDBsXWsUNrS-jDYfEjNXQ1YI8kV6orffagDm8Scv-mdib6tul_Oybnn_yPxhaZxqK-DJ52S_5MEOSTJIUUOueRQh4YOzZJ4pNM0Tlb_ZQNchs_ktx2KprO5WX08dGgUJ5r8FzKRmWjyaRA8TPSdDkKdkEOhNkE0WReZJdFTkCz6z4s_5NC3aGJ04rf6ovVr3m6rUUv6vn95PSCHbuZm9QUNlw7Fc7OtlZrgUZMvls7-_XyNUhNNRybbTF-U1tmiD4vWOEjHBXK43PYiq_Tyxtno8wrDUUc0HLe0l-115tM4CXWiw8yV1lfZu9uyWXQaru9Z1Hfe1OL3IB3fa3Mzy_Y4WMy037r48eXidtD6fHVFDk30b_O-Lz6cJ9HjeP2vPZarW2W57uPE5Be9Lz6WXry3x7R2DeLfRXd0cB1_imf5ue6sfZapLY5McaCfWhV3mNlYKK7Z4bilvTShuPrrexb1T0BxYLnsFCePTDOgn1o1c5jZWGim2eG4pb00oZn663sW9U9AM2C57DSjjkwzoJ9aNXOY2VhoptnhuKW9NKGZ-ut7FvVPQDNguew04x6ZZkA_tWrmMLOx0Eyzw3FLe2lCM_XX9yzqn4BmwHL9v9-Fdlz8TqezeJrqvX71aa9GpcNHvRl9Gs-Tkb5N4tG6zObPmzW3_iDUqdl8KzZ_XE43X60afA2LPCxew24GFtVgoWxoKazoMxtadXlashNX_MQVW7rDV-ZhAc6Lp6W0oVXbiu7xtMtO3OPhTgVY5mGPhbv8WXdZGNxzj4VdEOwz3gptoIWCVCp5gaehGHgcmgHgSA08jtwgCmrJDl6CwRfcUkUPgEZ-ADgSBMCRIRAO4iIKhskOHo2OV0wOL2hC8JIRHjh2XjPo1nnPiB4oXjBNpbDzNAw7j8OwAxyFncdh2HnLSmBZyasGbCygUdgBjsIOcBR2hIONl7xlJVg6yT_B5fBC2CWvGumCY-dVg26dN40EppEF01QJO6BR2AGOwo5wEHaAw6d-3rISWFbyqkFhB5ZF5wY0icIONInCDnC08bxlFdgaxb8g5_BC2BWvGgUe6BSvGnDrijeNAqZRBdNUCTugUdgBjsKOcBB2gKOwK96yClhW8apBb_nAsujcgCbRez7QJHrRBzjaeN6yCh07_9acw4th51Xjggc6l1dN_taHy3d_AwAA__8oqBQh

query I
(SELECT x FROM xyz WHERE x < 2) EXCEPT (SELECT x FROM xyz WHERE x >= 2) ORDER BY x
----
1

# EXCEPT ALL and EXCEPT with some overlap.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x >= 1) EXCEPT ALL (SELECT y FROM xyz WHERE x < 3) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcll9r2zwUxu_fT2HO1TumgWUn_WMoZIyOFUpb2lwMNl-4sdYE0sjIMjQr-e4jcVlnOz1PhOqL5K5p_JOOj34nj55poXN1lT2qkpIfJElQRIJiEjQgQUNKBRVGT1RZarN-pAYu8idKQkGzRVHZ9b9TQRNtFCXPZGd2riihcXY_V7cqy5UhQbmy2Wy-2aQws8fMLEdPy98k6OtsbpVJgpEMflZhGKuzQCZJcnE1JkHXlU2CUUTpSpCu7Mtmr3vcL4NpVk6b648kpatUUGmzB0WJXInei54E8bvWHL1Z8-s61UKbXBmVN1ZK1yR6ZMuLf8vK6Z2y10WzrvGyUElw_v3L-c04-Hx5SYLm6pf9fyQ_nJnZw3Tz19-Xlq2Xfn2h2OUQ7rSx7f6P5Mc3Fx_s0K1tjXhZdEsFV_qTLtp93br3sLG33MeR6KfofkdCHtpIgEPwG4loH7Xsp-h-tYwOTUtwCH5axvuoZT9F96tlfGhagkPw03Kwj1r2U3S_Wg4OTUtwCO93r92y-K0qC70o1U631nDdKpU_qLr1pa7MRN0YPdlsU3-83nCbm0muSlt_G9UfLhb1V-sCd4ePfWApveihF33K09KhZ5EbfOwDt3rmSg-96FOejtp0-C8dN-CwDccsPOBPa8DCkeS3HvrMBw-D-eBhNB-ABvMBaDAfRz7zwcNgPngYzQegwXwAGszHMWvpCS_pic98nPoYzsPAcB5GhgMaGA5olAAusdn9JXXJTVcahoBTcjrjQHPZSZGGqjLiRZd8jADTZSdHXFQHNHAd0Eh2hAPbEY5072Sok-48jXTnaag7wJHuAEe6d4K0qfsR0L2TKU66dzLFSXeeRrrzNNQd4Eh3gCPdO3nqpDtPI915GuoOcKQ7wJHunVRt3rVDXveoky2s7unqvz8BAAD__wcpd3c=

query I
(SELECT y FROM xyz WHERE x >= 1) EXCEPT ALL (SELECT y FROM xyz WHERE x < 3) ORDER BY y
----
1
2
2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz WHERE x >= 1) EXCEPT (SELECT y FROM xyz WHERE x < 3) ORDER BY y]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFv2kgQx9_vU1jzdKfbk9hdY4ilSJzaVI0UJVHCQ6WWBwdvgyWCkb1IoRHfvQKqEmw8f4yLDW8N9OcZz87_J5s3msShuQ1eTEr-V5IkSJEgTYJcEtSmgaBpEg9NmsbJ8r-sgevwlfyWoGgyndnlxwNBwzgx5L-RjezYkE_94GlsHkwQmoQEhcYG0XhVZJpEL0Ey773Of5CgT9HYmsR3etL5Nmu1tLl0pO_717d9EnQ3s77TUzRYCIpndlMstcGzIV8uxP4NfYxSG02GdrubnvxdR2bqbNCnuTMK0lGOHCw2vagyvRw4nKGj956NPqHZuIW9bK4zm8RJaBITbl1pdZW9uy2aRbvh-l6F-uKgFj8H6ejR2Lvpdo_9-dT4ztWXD1f3fef_mxsSNDbf7d89-c9lEj2PVv8qPPTNDXXKLNdjnNjsnvfkv4UX7-4xrV2D-HXRHR3cxv_F0-xcd9a-2KotT01xoKFaFXec4RyuuGZn4xb20oTi6q_vVah_BooDy1VNcerUNAMaqlUzxxnO4ZppdjZuYS9NaKb--l6F-megGbBc1TSjT00zoKFaNXOc4RyumWZn4xb20oRm6q_vVah_BpoBy1VNM-6paQY0VKtmjjOcwzXT7Gzcwl6a0Ez99b0K9c9AM2C5_tzvQjsu_mDSaTxJzV6_-rSWozLhs1mPPo1nydDcJ_FwVWb9592KW30QmtSuv5XrP64n66-WDb6HZRaW72F3C5blYKmr0EpWoi-q0LrD04qduOYnrtnSbb4yD0twXjytVBVatyrRXZ522Yl7PNwuAass7LFwhz_rDguDe-6ysAuCfcFboQW0kJNKKS_wNBQDj0MzABypgceRG2ROLduDV2DwObeU0QOgkR8AjgQBcGQIhIO4yJxhtgePRscrJoPnNCF5yUgPHDuvGXTrvGdkFxTPmaZU2Hkahp3HYdgBjsLO4zDsvGUVsKziVQM2FtAo7ABHYQc4CjvCwcYr3rIKLJ3in-AyeC7sileNcsGx86pBt86bRgHTqJxpyoQd0CjsAEdhRzgIO8DhUz9vWQUsq3jVoLADy6JzA5pEYQeaRGEHONp43rIabI3mX5AzeC7smleNBg90mlcNuHXNm0YD0-icacqEHdAo7ABHYUc4CDvAUdg1b1kNLKt51aC3fGBZdG5Ak-g9H2gSvegDHG08b1mNjp1_a87g-bDzqnHBA53LqyZ764PFXz8DAAD__wL4FCs=

query I
(SELECT y FROM xyz WHERE x >= 1) EXCEPT (SELECT y FROM xyz WHERE x < 3) ORDER BY y
----
2

# EXCEPT ALL and EXCEPT with swapped column orders.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz EXCEPT ALL SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcllGL2kAQx9_7KWSeWtiCm6itgYKlHPTgOI-rD4WSh5yZasDLht0NnD387iVJDxu1MxcmBfFxTX67_538wP8z5CbF2-QRHUQ_QIOCABSEoGAECsYQKyisWaJzxlavNMB1-gTRUEGWF6Wvfo4VLI1FiJ7BZ36DEMEiedjgPSYpWlCQok-yTX1IYbPHxG5nT9tfoGBe-mgw02oWQLxTYEr_Z8v9Tg_bwTpx6_YuL0iswPlkhRDpnfpP6QI109J0wT_T7bcqc2NTtJi2NosrknvlxBW_Jm79Df28aEdbbAuMBlffv1zdLQafb25AwQZ_-rd15HefbLZavyyoz7O_WSi42YnYt-a9KQ4HcPLgUetgfdY69pmufx31xeoYnLUVfabr34rgYq0Iz9qKPtP1b0V4sVaMztqKPtP1b8XoYq1giuQ9usLkDl_VWIbVtTBdYTMmZ0q7xDtrlvUxzXJec_V_corON0-DZnGdN4-qgK-HJxJ4KoG1KLce07TuMLKgGzyRwFMJrEW5D0Z2RAeH9PBvOqTnHZKwbs9seEiPJILTMCM4DTOC0zAnOEMzgo8lgtMwIzgNM4LTMCc4QzOCTySCf5AoSsOMojTMKErDnKIMzSj6UaIoDTOK0jCjKA1zijI0o-hUoqgW9QSGZiRlaMZShuY05XCuK8jKgqwtyOqCsC_ICoMWNQZ9VBk62UrTnK00zdlK06ytDM7Z2qUsHX-zLm2pK83Z2qkvdcY5W4_KA2lrvHvzOwAA___pMz-e

query II rowsort
SELECT x, y FROM xyz EXCEPT ALL SELECT y, x from xyz
----
2 1
3 1
4 2
5 2

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x, y FROM xyz EXCEPT SELECT y, x from xyz]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFr2zwUhu-_XxHO1TfQIJIcNzUMMrbCCqUtXS8GIxdurDWGNDa2A81K_vtIzEht1eet5oCSSyd9fI5P9byW8kLLLDHX8ZMpKfpJkgQpEqRJUECCRjQVlBfZzJRlVmz_pAYuk2eKhoLSZb6qth9PBc2ywlD0QlVaLQxFdB8_LMydiRNTkKDEVHG62BXJi_QpLtaT5_VvEnSzqqLBRIqJoulGULaq9rcsq_jRUCQ34v1lv6ZllS5nVbNmXYCptr_Bw3owj8v5W_x0s29KuTTlNAslJrJzFvoYZxF0NrW_1WqZFYkpTNK42e4uLm13zWXkv4WwRwvin7r8Fpfz76a6yZtt3q9zEw0ufny5uL0ffL66IkEL86v6f9f-h09F-jj_e_E-Ac8OO9zr7GOWtwfwZuFxo7D0EzigrJ_AOeQsHALnSGYRdDblKXC8tBD2aOGUAkf58R6U9eP9IWfh4P2RzCLobMqT915aCHu0cEreaz_eg7J-vD_kLBy8P5JZBJ1NefLeSwthjxZOyfvAj_egrB_vDzkLB--PZBZBZ1OevPfSQtijhVPyHvyadWfKPFuW5l2_HAy3j2WSR1OPqcxWxczcFtlsV6a-vNlxuw8SU1b1t7K-uFzWX20bfA3LNixfw0EDlm6wVL3o8z60CvvQWvO0Yieu-YlrtvSIr8zDEvTN02rYiz7rQ2uw0gJ24uCfPXKAVRsOWRg89Bm_UEJ-pYxZ-pyHz_uIzcNIbEADsXkaic3TSGwJshSFKR8rwG1AI7kBjuxGOFjpAEd-Sz5SJcKtdOFwy3HJxwt6dD5fJLBcWgnj9ArmafgOBjh6CfM4fAvzOLSVj1c5BoO38tXJVp6GtvI4tBXgaMnyOLTVStnG4JUE2yc-ZVu4ZauyosbFVsUnjQK7N8XvY8DgAI1sRTiwFeDIVoDDTTMfsmoEBm-lrIutgEa2AhzZinC0ZHkc2ar4LawaA5xP2RZu28rvYtGj80mjh-CsZSWNi62ARrYiHNgKcGQrwJGtmg9ZrcDgrZR1OuXyNDzm8jg85wIcHXR5HNmq-a2sRqPjU7aFW7Zqfi_bfvTp5r8_AQAA___0NvBD

query II rowsort
SELECT x, y FROM xyz EXCEPT SELECT y, x from xyz
----
5  2
4  2
2  1
3  1

# EXCEPT ALL and EXCEPT with different ORDER BY types.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcmNFr2lAUxt_3V8h52ugd9N5EbQMDxyisUNrS9mEwfEjNnQrWKzcR6or_-1AfrKY5X04iZvg2Nb-c65f9vnvtG01dYm_jF5tS9Js0KTKkKCBFISlqU1_RzLuBTVPnV5dsgOvklaJzRePpbJ6t3u4rGjhvKXqjbJxNLEX0FD9P7IONE-tJUWKzeDxZD5n58UvsF73XxV9SdDfPolZPq56h_lKRm2fbW6ZZPLQU6aUqP_bR-Wx_Ys-ccZO28POiNYrT0R6tqb_crsZIViMKwaheUBhC8F-FEBauZnsf5xPrbZJfRX8Fl7jqgy_2M05Hjza7m-1e_7SY2ah19evH1f1T6_vNDSma2D_Z557-8s2Ph6P1v7bfvjDkdu2Q9VnhzTuVM9MFady6r243iaLZ3Z3Zuhlzwdgjm3vIEATmNh1CWLiaEzK3SsilzTXN2APGHtmeQ4YgsKfpEMLC1ZyQPVVCLm1P0Iw9YOyR7TlkCAJ7mg4hLFzNCdlTJeTS9oTN2APGHtmeQ4YgsKfpEMLC1ZyQPVVCrvSb64ObP9h05qapLfWL6nwVlU2GdvMAUjf3A3vv3WA9ZvPybs2t30hsmm0-1ZsX19PNR6sFvof1Pqzfw-EOrGWw1rXobh3aBLXoS542bOIBn3ggSNzI4L3EpXS3Dr2XuJS-5OmQTbzNJ95m4Q7_rDv8swZ6dVn6gocv6rjJw8hNQAM3eRq5CWjg5iXfhuegDnNlKrET0EhPhAM_AY4ERTgwVOcqdTd4A4LnOxVIqnPtsjs8BMNz9SLaBXkaboMAR_sgj8ONEODANs13q-6A4HPtKtKNp6FuAEe68TjUDeBIN35n0WBr0bmSFenGl6wBJWskJZs_fIlKVowD3QCOdEM4OnjyJWtAyZpcyUp0AzTSDeFAN4Aj3RAOdDP8BmPABmP48yvQzfAla0DJGknJ5oeLSlaMI91EJSvGkW58yRpQskZygM__lxOd4MU40k10hhfjSDd-gwnABhPwfxLZ162__PQvAAD__2trUj4=

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x
----
3
4
5

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzU2N9r2l4Yx_H7718hz9V39Aw8P5KqMHBshRVKW9peDIYXqTmrgjWSRKgr_u9DHVh_5Pkknpjo3drunefsafIi853GUWhvg1ebUOcXSRKkSJAmQYYEedQTNImjvk2SKF78lVVwHb5RpyloOJ5M08W3e4L6UWyp807pMB1Z6tBT8DyyDzYIbUyCQpsGw9FyyCQevgbxrPs2-0OC7qZpp9GVoquoNxcUTdP1JZM0eLHUkXORf-xjFKfbE7vqIt8kVWTS92GSDsf9dGuWXI_amrNOn2eNQZAMdsrefH0WXeQshZatRFdnrsBUtmzvhJbtZ55lfZ3pOIpDG9tw40rLq-Q-bdYuLmue33KYLw464o8gGTza9G6yecan2cR2Glc_v13dPzW-3tyQoJH9nf7flZ--xMOXwfJPmb_09T-o7Xwby4tskJo51rVvE_-uuucIt9HnaLK92P3DNzmU9SgMxpaoMJhUqcJlLruAwsdctndCy_Yzz1KHwtXPbznMPwOFD7mN8yus6oEQjC0RQjCpUgjLXHYBCI-5bO-Elu1nnqUOCKuf33KYfwYQHnIb54dQ1wMhGFsihGBSpRCWuewCEB5z2d4JLdvPPEsdEFY_v-Uw_wwgPOQ2zg-hqQdCMLZECMGkSiEsc9kFIDzmsr0TWrafeZY6IKx-fsth_hlAeMhtfNgHlHuu_mCTSTRObK6PH5uLXdnwxa52n0TTuG_v46i_HLP68m7ZLb8R2iRd_VSuvrger360OODHWLKx4mO1HcuPsb8Ry2KxvHSplVOtnWoDas1u3PAbN2zs8bHHnhscm49ly6VWTrV2qg2ofXbjIL4sEKvtuMXGbf533eZRaPLnlrwpHkKFV0UCVuTOA7aZa5DvPGFFWAI1cgnkCCaQI5lAjmiSPC8S-CJ3nrTN3Af5zqNWxCdQI6BAjoQCOSIK5MgoyTsj2yDnpdnKd5ySvDWqCV4iwPsLoEqBNxj0CsNbo4A1yskaUMN3IDdrQA7fgtysUbw1ClijeGsUsEY5WQNqZA3IkTUgR9aAHFmjeGsUsEbx1ihgjeKt0cAa7WaN5q3RwBrNW6OBNdrJGlAja0COrAE5sgbk8L9cvDUaWKN5azSwRjtZA2pkDciRNSBH1oAcWaN5azSwRvPWaGCN5q0xwBrjZo3hrTHAGsNbY4A1xskaUCNrQI6sATmyBuTIGsNbY4A1hrfGAGuMkzWgRtaAHFkDcmQNyJE1hrfGAGsMb40B1hjeGg9Y4xW0pjf_728AAAD__79Z7lo=

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT y AS x FROM xyz ORDER BY z) ORDER BY x
----
3
4
5

# EXCEPT ALL and EXCEPT with different numbers of ORDER BY columns.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcmM1q20AUhfd9CnNXLZlCZiTbiaCgUgINhCQkWRSKF4o1jQ2Ox4xkiBv87sXywrFU36Mr_4F38c-nOznKd2aUdxq71N4mrzaj6DdpUmRIUUCKQlLUpp6iiXd9m2XOL76yBK7TN4rOFQ3Hk2m-eLunqO-8peid8mE-shTRU_I8sg82Sa0nRanNk-GoGDLxw9fEz-K32V9SdDfNo1asVWyoN1fkpvnqklmevFiK9FzVH_vofF6eGJszbtIKfp61Bkk2KNGaevPVaoxkNeIQVBxszCHYQQ4qDs7AQFkc4cZFra7jfGq9Tas3pbeA0beKJRcjy7_jzyQbPNr8brLOPM0mNmpd_fpxdf_U-n5zQ4pG9k_-OdZfvvnhy6D4aRXCxrzbW-etzzZevNM4N70hjVv31a0nsWl2d222Po7HYOyBPd51CPU9bpbDnj3Wp-txk7xre2yO4xIYe2CXdh1CfZea5bBnl8zputQk79ouBcdxCYw9sEu7DqG-S81y2LNLwem61CTv2i6Fx3EJjD2wS7sOob5LzXLYs0vh6brUJO9Gz2r_ufiDzSZunNlaT2Lni6hs-mKXNyFzU9-39971izHLl3cFV7yR2ixffqqXL67Hy48WC_wI6zKsP8LhGqxlsNZb0d1taBNsRV_ytGETD_jEA0HiRgaXEpfS3W3oUuJS-pKnQzbxNp94m4U7_L3u8Pca6NVl6QsevtjGTR5GbgIauMnTyE1AAzcv-TY8B3VYKVOJnYBGeiIc-AlwJCjCgaG6UqnrwRsQPN-pQFJdaZf14SEYXqkX0S7I03AbBDjaB3kcboQAB7Zpvlt1BwRfaVeRbjwNdQM40o3HoW4AR7rxO4sGW4uulKxIN75kDShZIynZ6uFLVLJiHOgGcKQbwtHBky9ZA0rWVEpWohugkW4IB7oBHOmGcKCb4TcYAzYYw59fgW6GL1kDStZISrY6XFSyYhzpJipZMY5040vWgJI1kgN89U9OdIIX40g30RlejCPd-A0mABtMwP9LpKxbb_7pXwAAAP__NzRgTg==

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT ALL (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----


query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzU2F9r2mwYx_Hz51XIdfQ89H7A-4-pCgPHVlihtKXtwWB4kJp7VbAmJBHqiu99qANrNNcvyR2Seba2--a6dzX5kPlOizCwt_6rTWj4gyQJUiRIkyBDgno0FhTF4cQmSRhv_souuA7eaNgVNFtEy3Tz7bGgSRhbGr5TOkvnlob05D_P7YP1AxuToMCm_my-HRLFs1c_Xo3eVr9I0N0yHXZGUowUjdeCwmW6v2SS-i-WhnItio99DOM0O3GkLopNUmUmfZ0l6WwxSTOz5H5UZs4-fV51pn4yPSrH6_1ZdJmzlF62GOncLZga9i1G-qLwwN5ftHYv9yz76ywXYRzY2AYHV9pepfBp83Zx2fL8vsN8UemI3_xk-mjTu-jwjE-ryA47V9-_XN0_dT7f3JCguf2Z_juS_32KZy_T7Z9yf-n7f9DA-W6WF_k0dQus69Qm_lz1xBFuw__DKLvY08MPYZTteAzG1ugxmNSox3Uvu7jH1fbt4HG7a_dyz9KGx83P7zvMPwOPq9zNxT1W7ZAIxtZIIpjUKIl1L7s4idX27UBiu2v3cs_SBonNz-87zD8DEqvczcVJ1O2QCMbWSCKY1CiJdS-7OInV9u1AYrtr93LP0gaJzc_vO8w_AxKr3M3FSTTtkAjG1kgimNQoiXUvuziJ1fbtQGK7a_dyz9IGic3P7zvMPwMSq9zN1T7IPHH1B5tE4SKxhT6m7G52ZYMXu9t9Ei7jib2Pw8l2zO7Lu223_UZgk3T3U7n74nqx-9HmgB9jycaKj1U2lh9j7yCW5WJ56VIrp1o71QbUmt244Tdu2LjHxz323ODYfCz7LrVyqrVTbUDtsRsH8WWJWGXjPhsP-N_1gEehy59b8qb0ECq8KhKwIo8esMNcg_zoCSvDEqiRSyBHMIEcyQRyRJPkeZHAF3n0pB3mHsiPHrUyPoEaAQVyJBTIEVEgR0ZJ3hk5ADkvTSY_ckry1qgueIkA7y-AKgXeYNArDG-NAtYoJ2tADd-B3KwBOXwLcrNG8dYoYI3irVHAGuVkDaiRNSBH1oAcWQNyZI3irVHAGsVbo4A1irdGA2u0mzWat0YDazRvjQbWaCdrQI2sATmyBuTIGpDD_3Lx1mhgjeat0cAa7WQNqJE1IEfWgBxZA3Jkjeat0cAazVujgTWat8YAa4ybNYa3xgBrDG-NAdYYJ2tAjawBObIG5MgakCNrDG-NAdYY3hoDrDFO1oAaWQNyZA3IkTUgR9YY3hoDrDG8NQZYY3hresCaXklrxut_fgcAAP__Fyz4eA==

query I
(SELECT x FROM xyz ORDER BY y) EXCEPT (SELECT x FROM xyz ORDER BY y, z) ORDER BY x
----

# EXCEPT ALL and EXCEPT with compatible ORDER BY columns that are not in the final result.
query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) EXCEPT ALL (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzcl1Fr4k4Uxd__n0Lu03_ZWXAm0W4DC1mWwhZKLa0PC0seUjOrgnXCZIS6xe--aGCt0dxjmCWKb1Xz89w5uSenvtHcZPo-fdEFRT9JkiBFggISFJKgHiWCcmtGuiiMXV9SArfZK0VdQdN5vnDrtxNBI2M1RW_kpm6mKaJh-jzTjzrNtCVBmXbpdLYRye30JbXL-HX5mwQNFi7qxErEASUrQWbhtl9ZuHSsKZIrcbzsk7Guqhirj3-VpIhVRWkLPy87k7SYVGhJyWo7jWoyzb8zITgrE8LaabbfY2ymrc72p0jW8BFXHTjY97SYPGk3yHevHy5zHXVufny7eRh2vt7dkaCZ_uX-j-WHL3Y6nmz-2p6-1uTeEcdazA-NfHDae_PJ5JXLDgv3d4TlaZIFZFtOVmsmBGdlQlg7zQUlS51mwYFsywvemgnBWZkQ1k5zQQsenGbBgWzLC96aCcFZmRDWTnNBCx6eZsGBbMsL3poJwVmZENZOc0ELDn5hPeoiN_NCH_XffXd9Gp2NdelRYRZ2pB-sGW1kypeDDbd5I9OFKz-V5YvbefnResD3sKzC8j0c7sCyGSy7XnTPh1Ze2gpoK9bxgHc8aOC4agZXHG9K93xo5aWtgHbIOg5uV4-FVZ-_X32WvuLhK5948TCKF6CBZzyN4gVooP2Zdfyad_zaJ148jOIFaLDiPI3iBWigLfkOQY_ivafpbgMpUEF7j9NGHcTTsIQAjo7O47CGAI7U9x6qu8aHwPi9p2qTrAAahQXhaGN5HMUF4UidrxR02_hKkaBTpFepABrmxa9WAA7z4lcskm8WCapFenULoGFe_NoF4DAvfv2ivPpF8f2iQL8or34BNMoLwtHR_foF4Uid7xcF-kV59QugUV4QjjbWr18QjtSb9Uuy-u9PAAAA__9nzVH7

query I rowsort
(SELECT y FROM xyz ORDER BY z) EXCEPT ALL (SELECT y FROM xyz ORDER BY z)
----

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) (SELECT y FROM xyz ORDER BY z) EXCEPT (SELECT y FROM xyz ORDER BY z)]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmF9r2lAYxu_3KeS92tgZeP4kjcLAsRVWKG1pezEYXqTmrAasCUmEuuJ3HyrMmizv0yxyondV-8vz5kn88ZoXmieRvQqfbE7DnyRJkCJBmgQZEuTRWFCaJROb50m2_pctcBE907AvKJ6ni2L99ljQJMksDV-oiIuZpSHdhw8ze2vDyGYkKLJFGM82IWkWP4XZcvS8_E2CrhfFsDdSYqRpvBKULIrdIfMifLQ0lCvx9ti7JCvKiSP18W-SFCNVm6SaJH2L8yKeT4pSltxFlXJ26MOyNw3zaYUcr3az6CazHK5s46xs74jK9mtn2R1nMU-yyGY22jvS5ihvnraui7OO84MW-eK_Rvwe5tM7W1yn-zPeL1M77J3_-Hp-c9_7cnlJgmb2V_F-JD98zuLH6eav2ou-O6HBYQu9Sj4lafm8_y2r_l6y7EaSIPaAkgRJTiXprGzjrGzviMr2a2fpQpLu84MW-ScgSdWNqkDsAVUFkpyqylnZxlnZ3hGV7dfO0oWq3OcHLfJPQFW6G1WB2AOqCiQ5VZWzso2zsr0jKtuvnaULVbnPD1rkn4CqTDeqArEHVBVIcqoqZ2UbZ2V7R1S2XztLF6pynx-0yD8BVYFHsLc2T5N5bt_0GKy_PhsbPdptO3myyCb2Jksmm5jty-sNt3kjsnmx_VRuX1zMtx-tB3wNSxZWPKzKsHwN-3uwbAbLVrTy2tDatKGN5mnNNm74xg0LezzssXOf8WPzsGxFK3CxeVqDi83TBlxsn2084OGzBrAqwwELD_jkAX-X-cAKwClIKrxVJNCKbOUVQCOxAByZBeBILQBHbpG8XCSwi-T1IoFfZCvBABoZBuBIMQBHjgE4kozkLSOBZiTvGQlEI1uZRvKqUX2wQ_CqUUA1qqKaRjsIT8MlhMfhFsLjcA3hceQKVVHNfvEaFM-rRgHVqIpqmrgC0MgVAEeuADhyBcCRK1RFNfvFo3PnVVPCK65QvGqAKxRvGjUANw2vGg1UoyuqaeIKQCNXABy5AuDIFQCHv1n4hU6DhU7zqtFANbqimiauADRyBcCRKwCOXAFw5ArNL3QaDc-rpoRXXKF51QBXaN40OgA3Da8aDVSjK6pp5Aqehq7gcegKHoeu4HHkCsMvdAYsdIZXjQGqMfwPKPBlBzRyBcCRKwCOXAFw5AoDHkyhdF41JbziCsOrpuyK8erdnwAAAP__cVHs9g==

query I rowsort
(SELECT y FROM xyz ORDER BY z) EXCEPT (SELECT y FROM xyz ORDER BY z)
----

# EXCEPT ALL and EXCEPT with a projection on the result.
query I rowsort
SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT ALL (SELECT x, y FROM xyz))
----

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT ALL (SELECT x, y FROM xyz))]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzclkFr2zAUx-_7FOGdNtAgkpNsMQwyRmGF0pQuh8HwwY3fEkNqGUmGZiXffdheyezEejHvYnJU7J_01_MP8n-FTCd4Hz-jhfAXSBCgQEAAAiYgYAqRgNzoNVqrTflKDdwmLxCOBaRZXrjy50jAWhuE8BVc6nYIIazipx0-YpygAQEJujjdVYfkJn2OzX7xsv8DApaFC0cLKRYKooMAXbh_Wx53etqPtrHdNnd5QyIB1sUbhFAexIDTqc50x62KTJsEDSaNzaKSpF45c8Xvsd3-QLfMm9FW-xzD0c3PbzcPq9HXuzsQsMPf7n0V-cMXk262b4vjAFq3P14rYFzrTOZ7_VHn7dufPXjSOFgO7GvLQadTnemuyEU1sKHLQadTnemuSIlgYEOXg06nOtNdkRKTgQ1dDjqd6kx3RUoQzfERba4zixe1lHF5J0w2WM_I6sKs8cHodXVMvVxWXPU_nKB19VNVL26z-lEZ8HJ4xoHnHFiycsupn5Y9Rqb6wTMOPOfAkpW7NbITWrXp8f904J934IVlc2bjNj3hCO6HCcH9MCG4H6YEJ2hC8ClHcD9MCO6HCcH9MCU4QROCzziCf-Io6ocJRf0woagfphQlaELRzxxF_TChqB8mFPXDlKIETSg65ygqWT2BoAlJCZqwlKApTSmc6gq8ssBrC7y6wOwLvMIgWY1BnlSGXrb6acpWP03Z6qdJWwmcsrVPWTr9Zn3aUl-asrVXX-qNU7aelAevrdHh3d8AAAD__1FYPIg=

query I rowsort
SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT (SELECT x, y FROM xyz))
----

query T
SELECT "URL" FROM [EXPLAIN (DISTSQL) SELECT x FROM ((SELECT x, y FROM xyz) EXCEPT (SELECT x, y FROM xyz))]
----
https://cockroachdb.github.io/distsqlplan/decode.html?eJzUmFFr2zwUhu-_XxHO1TfQIJIcNzUMOrbCCqUtXS8GIxdurDWGNDa2As1K_vtIzEht1eet5xIll076-Byd6nkt55kWWWKu4kdTUvSTJAlSJEiToIAEjWgiKC-yqSnLrNj8SQVcJE8UDQWli3xpNx9PBE2zwlD0TDa1c0MR3cX3c3Nr4sQUJCgxNk7n2yJ5kT7GxersafWbBF0vbTQ4k-JM0WQtKFva3S1LGz8YiuRavL3s17S06WJq6zWrAky13Q3uV4NZXM5e4yfrXVOqS1PvNwt9iLMIWpva3Wq5yIrEFCap3Wx7ly5tt81l5L-FsEcL4p-6_BaXs-_GXuf1Nu9WuYkG5z--nN_cDT5fXpKgufll_9-2_-FTkT7M_l7stkHrsk7ed7JX2ccsb67-1cLjWmHpJ21AWT9ps7dZ6EOcRdDalKe08dJC2KOFo0kb5Ud6UNaP9HubhT7EWQStTXmS3ksLYY8WjkZ67Ud6UNaP9HubhT7EWQStTXmS3ksLYY8Wjkb6wI_0oKwf6fc2C32Iswham_IkvZcWwh4tHI304OerW1Pm2aI0b_q1YLhZk0keTDWjMlsWU3NTZNNtmeryesttP0hMaatvZXVxsai-2jT4EpZNWL6Egxosu8FS9aJP-9Aq7ENrzdOKnbjmJ67Z0iO-Mg9L0DdPq2Ev-qQPrcFOC9iJg3_2qAOsmnDIwmDRJ_xGCfmdMmbpUx4-7SM2DyOxAQ3E5mkkNk8jsSXIUhSmfKwAtwGN5AY4shvhYKcDHPkt-UiVCHfShcMdxyUfL2jpfL5IYLl0EqbTI5in4TMY4OghzOPwKczj0FY-XuUYDN7J10628jS0lcehrQBHW5bHoa1OytYGryQ4PvEp28AdW5UTNV1sVXzSKHB6U_w5BgwO0MhWhANbAY5sBTg8NPMhq0Zg8E7KdrEV0MhWgCNbEY62LI8jWxV_hFVjgPMp28BdW_lTLFo6nzR6CN61nKTpYiugka0IB7YCHNkKcGSr5kNWKzB4J2U7veXyNHzN5XH4ngtw9KLL48hWzR9lNRodn7IN3LFV82fZ5tIn6__-BAAA__8JI-0t
